#include "topconn.ch"
#include "protheus.ch"
#include "msgraphi.ch"
#include "msserial.ch"
#include "eicconst.CH"

/*

ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
ฑฑษออออออออออัออออออออออหอออออออัออออออออออออออออออออหออออออัอออออออออออออปฑฑ
ฑฑบPrograma  ณLTMOV009  บAutor  ณMarcelo Joner       บ Data ณ  10/02/2020 บฑฑ
ฑฑฬออออออออออุออออออออออสอออออออฯออออออออออออออออออออสออออออฯอออออออออออออนฑฑ
ฑฑบDesc.     ณRotina de registro de pesagem de veํculos.                  บฑฑ
ฑฑฬออออออออออุออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออนฑฑ
ฑฑบUso       ณ Laticinio                                                  บฑฑ
ฑฑศออออออออออฯออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออผฑฑ
ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿
*/
User Function LTMOV009()

	Local cAliasH	  	:= "ZM1"
	Local cUsrQld		:= GETMV("MV_ZL00008",, "")
	Local nX
	Private cCadastro	:= "Pesagens"
	Private aRotina		:= MENUDEF()
	Private aCores		:= {{"ZM1_STATUS == '1'", 'BR_VERDE'	, "Pesagem - Em Aberto"	},;
		{"ZM1_STATUS == '2'", 'BR_VERMELHO'	, "Pesagem - Finalizada"},;
		{"ZM1_STATUS == '9'", 'BR_PRETO'	, "Pesagem - Cancelada"	}}

	Private aCoresCon		:= {{"ZM1_STATUS == '1'", 'BR_VERDE'	, "Pesagem - Em Aberto"	},;
		{"(ZM1_STATUS == '2' .AND. ZM1_SITQLD == ' ') .OR. (ZM1_STATUS == '2' .AND. ZM1_SITCON == 'F'  .AND. ZM1_SITQLD == 'F' .AND. ZM1_FATCON > 0)"					, 'BR_VERMELHO'	, "Pesagem - Finalizada"},;
		{"(ZM1_STATUS == '2' .AND. ZM1_SITQLD == ' ') .OR. (ZM1_STATUS == '2' .AND. ZM1_SITCON != 'F'  .AND. ZM1_SITQLD != 'F')"					, 'BR_AZUL'		, "Analises Pendentes"},;
		{"ZM1_STATUS $ '1/2' .AND. ZM1_SITQLD == 'F' .AND. ZM1_SITCON == 'P' .AND. ZM1_STPROT <> 'P' .AND. ZM1_FATCON > 0 .AND. ZM1_PRCSOL == 0 .AND. ZM1_SLLT <> 0"   	, 'TABPRICE'		, "Sem Pre็o de Solidos"	},;
		{"ZM1_STATUS $ '1/2' .AND. ZM1_SITQLD == 'F' .AND. ZM1_SITCON == 'P' .AND. ZM1_STPROT <> 'P' "  											, 'BR_VIOLETA'		, "Concilia็ใo Pendente"	},;
		{"ZM1_STATUS $ '1/2' .AND. ZM1_SITQLD == 'F' .AND. ZM1_SITCON == 'F' .AND. ZM1_STPROT <> 'P' .AND. ZM1_FATCON = 0"  						, 'PMSRRFSH'		, "Re-Concilia็ใo Pendente"	},;
		{"ZM1_STATUS == '9'", 'BR_PRETO'	, "Pesagem - Cancelada"	}}

	Private aCoresQld	:= {{"ZM1_STATUS == '1'  .AND. ZM1_SITQLD != 'F' .AND. EMPTY(ZM1_STPROT)"							, 'BR_AMARELO'		, "Pesagem - Em Aberto"		},;
		{"ZM1_STATUS != '9'  .AND. ZM1_SITQLD == ' '"													, 'BR_MARRON_OCEAN'	, "Pesagem - Finalizada"	},;
		{"ZM1_STATUS == '9'"																			, 'BR_CANCEL'		, "Pesagem - Cancelada"		},;
		{"ZM1_STATUS == '2'  .AND. ZM1_SITQLD != 'F' .AND. EMPTY(ZM1_STPROT)"							, 'BR_VERDE'		, "Qualidade - Em Aberto"	},;
		{"ZM1_STATUS $ '1/2' .AND. ZM1_SITQLD == 'E' .AND. ZM1_SITCON <> 'P'"							, 'BR_AZUL'	 		, "Qualidade - Em Execu็ใo"	},;
		{"ZM1_STATUS $ '1/2' .AND. !EMPTY(ZM1_STPROT) .AND. ZM1_STPROT <> 'F' "	, 'UPDWARNING'			, "Qualidade - Aguardando Protocolo"},;
		{"ZM1_STATUS $ '1/2' .AND. ZM1_SITQLD == 'F' .AND. ZM1_SITCON == 'P' .AND. ZM1_STPROT <> 'P' .AND. ZM1_FATCON == 0" 	, 'BR_VIOLETA'		, "Qualidade - Finalizada"	},;
		{"ZM1_STATUS == '2'  .AND. ZM1_SITQLD == 'F' .AND. ( ZM1_SITCON == 'F' .OR. ZM1_SITCON == 'P') .AND. ZM1_FATCON > 0"						, 'BR_VERMELHO'		, "Concilia็ใo - Efetuada"}}



//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
//ณSeta tecla F12 como tecla para executar fun็ใo de remo็ใo da balan็a configurada para integra็ใoณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	SetKey(VK_F12, {|| LT019BLKILL()})

//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
//ณApresenta็ใo do browse da rotinaณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	oMBrowse := FWMBrowse():New()
	oMBrowse:SetAlias(cAliasH)
	oMBrowse:SetDescription(cCadastro)

//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
//ณAdiciona defini็๕es de legenda caso o usuแrio possui permissใo do processo de Qualidadeณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	If __cUserId $ cUsrQld
		For nX := 1 To Len(aCoresQld)
			oMBrowse:AddLegend(aCoresQld[nX][1], aCoresQld[nX][2], aCoresQld[nX][3])
		Next nX
	ElseIf __cUserId $ SuperGetMV("MX_PRECCON",,"")
		For nX := 1 To Len(aCoresCon)
			oMBrowse:AddLegend(aCoresCon[nX][1], aCoresCon[nX][2], aCoresCon[nX][3])
		Next nX
	Else
		//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		//ณAtualiza defini็๕es de legenda quando o usuแrio nใo possui permissใo para o processo de Qualidadeณ
		//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		For nX := 1 To Len(aCores)
			oMBrowse:AddLegend(aCores[nX][1], aCores[nX][2], aCores[nX][3])
		Next nX
	EndIf

//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
//ณAdiciona defini็๕es de vis๕esณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	oMBrowse:SetAttach(.T.)
	oMBrowse:SetOpenChart(.F.)
	oTableAtt := LT009VIEW()
	oMBrowse:SetViewsDefault(oTableAtt:aViews)
	oMBrowse:SetChartsDefault(oTableAtt:aCharts)
	oMBrowse:Activate()

//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
//ณFecha a tabela manipuladaณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	If Select(cAliasH) > 0
		(cAliasH)->(dBCloseArea())
	EndIf

//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
//ณRemove vinculo de fun็๕es com algumas teclas especificas para com a rotinaณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ   
	SET KEY VK_F12 TO

Return





/*

ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
ฑฑษออออออออออัออออออออออหอออออออัออออออออออออ`ออออออออหออออออัออออออออออออปฑฑ
ฑฑบPrograma  ณLT009VIEW  บAutor  ณMarcelo Joner       บ Data ณ 12/02/2020 บฑฑ
ฑฑฬออออออออออุออออออออออสอออออออฯออออออออออออออออออออสออออออฯอออออออออออออนฑฑ
ฑฑบDesc.     ณFun็ใo responsแvel pela defini็ใo de vis๕es e grแficos no   บฑฑ
ฑฑบ          ณbrowse da rotina de pesagens.                               บฑฑ
ฑฑฬออออออออออุออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออนฑฑ
ฑฑบUso       ณ Laticinio                                                  บฑฑ
ฑฑศออออออออออฯออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออผฑฑ
ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿
*/
Static Function LT009VIEW()

	Local oTableAtt	:= FWTableAtt():New()

//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
//ณPesagem - Em Abertoณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	oPesAbe := FWDSView():New()
	oPesAbe:SetID("LT9V01")
	oPesAbe:SetName("Em Aberto")
	oPesAbe:SetPublic(.T.)
	oPesAbe:SetCollumns(U_GLCPOBRW("ZM1"))
	oPesAbe:SetOrder(1)
	oPesAbe:AddFilter("Pesagens - Em Aberto", "ZM1_STATUS == '1'")
	oTableAtt:AddView(oPesAbe)

//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
//ณPesagem - Finalizadaณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	oPesFin := FWDSView():New()
	oPesFin:SetID("LT9V02")
	oPesFin:SetName("Finalizadas")
	oPesFin:SetPublic(.T.)
	oPesFin:SetCollumns(U_GLCPOBRW("ZM1"))
	oPesFin:SetOrder(1)
	oPesFin:AddFilter("Pesagens - Finalizadas", "ZM1_STATUS == '2'")
	oTableAtt:AddView(oPesFin)

//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
//ณPesagem - Canceladaณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	oPesCan := FWDSView():New()
	oPesCan:SetID("LT9V03")
	oPesCan:SetName("Canceladas")
	oPesCan:SetPublic(.T.)
	oPesCan:SetCollumns(U_GLCPOBRW("ZM1"))
	oPesCan:SetOrder(1)
	oPesCan:AddFilter("Pesagens - Canceladas", "ZM1_STATUS == '9'")
	oTableAtt:AddView(oPesCan)

	oTableAtt:SetAlias("ZM1")

Return oTableAtt





/*

ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
ฑฑษออออออออออัออออออออออหอออออออัออออออออออออออออออออหออออออัอออออออออออออปฑฑ
ฑฑบPrograma  ณMENUDEF   บAutor  ณMarcelo Joner       บ Data ณ  10/02/2020 บฑฑ
ฑฑฬออออออออออุออออออออออสอออออออฯออออออออออออออออออออสออออออฯอออออออออออออนฑฑ
ฑฑบDesc.     ณDefini็ใo das sub-rotinas da rotina principal               บฑฑ
ฑฑบ          ณ                                                            บฑฑ
ฑฑฬออออออออออุออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออนฑฑ
ฑฑบUso       ณ Laticinio                                                  บฑฑ
ฑฑศออออออออออฯออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออผฑฑ
ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿
*/
Static Function MENUDEF()

	Local aRotina	:= {{"&Pesquisar"				, "AxPesqui"	, 0 , 1},;
		{"&Visualizar"				, "U_LT019VIS"	, 0 , 2},;
		{"&Abrir"					, "U_LT019ABE"	, 0 , 3},;
		{"&Fechar"					, "U_LT019FEC"	, 0 , 4},;
		{"Al&terar"					, "U_LT019ALT"	, 0 , 4},;
		{"&Cancelar"				, "U_LT019CAN"	, 0 , 2},;
		{"&Descarte"				, "U_LT019DES"	, 0 , 2},;
		{"&New Qualidade "			, "U_LTMOV9D"	, 0 , 4},;
		{"&Analise por Produtor "	, "U_LTMOV9E"	, 0 , 4},;
		{"&Libera Descarregamento "	, "U_LT9FIN2"	, 0 , 4},;
		{"&Abertura de RNC "		, "U_LTMOV9F"	, 0 , 4},;
		{"C&oncilia็ใo"				, "U_LT019CON"	, 0 , 4},;
		{"&Imprime Matric"			, "U_LT019IMP"	, 0 , 6},;
		{"&Imprime Laser"			, "U_LTREL047"	, 0 , 6},;
		{"&Legenda"					, "U_LT019LEG"	, 0 , 2}}

Return aRotina
//{"&Qualidade"				, "U_LT019QUA"	, 0 , 4},;




/*

ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
ฑฑษออออออออออัออออออออออหอออออออัออออออออออออออออออออหออออออัอออออออออออออปฑฑ
ฑฑบPrograma  ณLT019LEG   บAutor  ณMarcelo Joner      บ Data ณ  14/02/2020 บฑฑ
ฑฑฬออออออออออุออออออออออสอออออออฯออออออออออออออออออออสออออออฯอออออออออออออนฑฑ
ฑฑบDesc.     ณRotina responsavel pela apresentacao da tela referente as   บฑฑ
ฑฑบ          ณdefini็๕es de legenda da rotina de pesagens.                บฑฑ
ฑฑฬออออออออออุออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออนฑฑ
ฑฑบUso       ณ Laticinio                                                  บฑฑ
ฑฑศออออออออออฯออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออผฑฑ
ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿
*/
User Function LT019LEG()

	Local nI		:= 0
	Local aLegenda	:= {}
	Local oLegenda	:= FWLegend():New()
	Local cUsrQld	:= GETMV("MV_ZL00008",, "")

//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
//ณComp๕e array com as legendas padr๕es da rotinaณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	If __cUserId $ cUsrQld
		For nI := 1 To Len(aCoresQld)
			AADD(aLegenda, {aCoresQld[nI][2],aCoresQld[nI][3]})
		Next nI
	Else
		For nI := 1 To Len(aCores)
			AADD(aLegenda, {aCores[nI][2],aCores[nI][3]})
		Next nI
	EndIf
//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
//ณAdiciona legendas para apresenta็ใoณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	For nI := 1 To Len(aLegenda)
		oLegenda:Add("",aLegenda[nI][1], aLegenda[nI][2])
	Next nI

//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
//ณApresenta legenda ao usuแrioณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	oLegenda:Activate()
	oLegenda:View()

Return





/*

ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
ฑฑษออออออออออัออออออออออหอออออออัออออออออออออออออออออหออออออัอออออออออออออปฑฑ
ฑฑบPrograma  ณLT019VIS   บAutor  ณMarcelo Joner      บ Data ณ  11/02/2020 บฑฑ
ฑฑฬออออออออออุออออออออออสอออออออฯออออออออออออออออออออสออออออฯอออออออออออออนฑฑ
ฑฑบDesc.     ณFun็ใo responsแvel pela funcionalidade de visualiza็ใo do   บฑฑ
ฑฑบ          ณregistro de pesagem.                                        บฑฑ
ฑฑฬออออออออออุออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออนฑฑ
ฑฑบUso       ณ Laticinio                                                  บฑฑ
ฑฑศออออออออออฯออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออผฑฑ
ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿
*/
User Function LT019VIS(cAlias, nReg, nOpc)

//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
//ณExecuta fun็ใo de apresenta็ใo da interface de pesagemณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	LT019DET(cAlias, nReg, nOpc)

Return





/*

ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
ฑฑษออออออออออัออออออออออหอออออออัออออออออออออออออออออหออออออัอออออออออออออปฑฑ
ฑฑบPrograma  ณLT019ABE   บAutor  ณMarcelo Joner      บ Data ณ  11/02/2020 บฑฑ
ฑฑฬออออออออออุออออออออออสอออออออฯออออออออออออออออออออสออออออฯอออออออออออออนฑฑ
ฑฑบDesc.     ณFun็ใo responsแvel pela funcionalidade de abertura de novas บฑฑ
ฑฑบ          ณpesagens.                                                   บฑฑ
ฑฑฬออออออออออุออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออนฑฑ
ฑฑบUso       ณ Laticinio                                                  บฑฑ
ฑฑศออออออออออฯออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออผฑฑ
ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿
*/
User Function LT019ABE(cAlias, nReg, nOpc)

//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
//ณExecuta fun็ใo de apresenta็ใo da interface de pesagemณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	LT019DET(cAlias, nReg, nOpc)

	MBrChgLoop(.F.)

Return





/*

ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
ฑฑษออออออออออัออออออออออหอออออออัออออออออออออออออออออหออออออัอออออออออออออปฑฑ
ฑฑบPrograma  ณLT019FEC   บAutor  ณMarcelo Joner      บ Data ณ  14/02/2020 บฑฑ
ฑฑฬออออออออออุออออออออออสอออออออฯออออออออออออออออออออสออออออฯอออออออออออออนฑฑ
ฑฑบDesc.     ณFun็ใo responsแvel pela funcionalidade de fechamento das    บฑฑ
ฑฑบ          ณpesagens existentes na rotina.                              บฑฑ
ฑฑฬออออออออออุออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออนฑฑ
ฑฑบUso       ณ Laticinio                                                  บฑฑ
ฑฑศออออออออออฯออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออผฑฑ
ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿
*/
User Function LT019FEC(cAlias, nReg, nOpc)
	Local lAchou	:= .F.
	Local _lProt	:= .F. // indica se pesagem precisa de protocolo
//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
//ณVerifica se เ pesagem posicionada realmente estแ em aberto,ณ
//ณcaso contrario, alerta o usuario e nใo permite o fechamentoณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

	If ZM3->(dbSeek(xFilial("ZM3") + ZM1->ZM1_NUM))
		While ZM3->(!EOF()) .AND. ZM3->ZM3_FILIAL == xFilial("ZM3") .AND. ZM3->ZM3_NUM == ZM1->ZM1_NUM
			If ZM3->ZM3_STATUS == "D"
				If !EMPTY(ZM3->ZM3_USRDES)
					lAchou := .F.
					exit
				Else
					lAchou := .T.
				EndIf
			EndIf
			ZM3->(dbSkip())
		End
	Else // Processo novo de qualidade, mantido o processo antigo para compatibilidade
		dbSelectArea('ZM4')
		ZM4->(dbSetOrder(1))
		ZM4->(dbGoTop())
		If ZM4->(dbSeek(xFilial('ZM4')+ZM1->ZM1_NUM))
			While ZM4->(!Eof()) .And. ZM4->ZM4_FILIAL == xFilial("ZM4") .AND. ZM4->ZM4_NUM == ZM1->ZM1_NUM
				If ZM4->ZM4_STATUS == "D"
					If !EMPTY(ZM1->ZM1_USRDES)
						lAchou := .F.
						exit
					Else
						lAchou := .T.
					EndIf
				ElseIf ZM4->ZM4_STATUS == 'P'
					_lProt := .t.
				EndIf

				ZM4->(DbSkip())
			EndDo
		EndIf
	EndIf

	If ZM1->ZM1_STATUS != "1"
		If ZM1->ZM1_STATUS == "2"
			U_GLALL001("Aten็ใo", "A pesagem selecionada para fechamento jแ estแ finalizada.", "Somente ้ possํvel efetuar o fechamento de pesagens que estejam em aberto.")
		EndIf

		If ZM1->ZM1_STATUS == "9"
			U_GLALL001("Aten็ใo", "A pesagem selecionada para fechamento estแ cancelada.", "Nใo ้ possivel fechar pesagens que estejam canceladas.")
		EndIf

		Return
	Else
		If lAchou
			U_GLALL001("Aten็ใo", "A pesagem selecionada para fechamento possui DESCARTE", "Utilize a Rotina de Descarte ou Contate o Laborat๓rio!")
		Else
			If EMPTY(ZM1->ZM1_STPROT)
				If ZM1->ZM1_LIBPRO <> 'S' .and. _lProt
					U_GLALL001("Aten็ใo", "Protocolo necessแrio!", "Utilize a Rotina de Libera็ใo para Descarregamento ou abra um Protocolo!")
					Return
				EndIf
			ElseIf ZM1->ZM1_STPROT <> "F" .and. ZM1->ZM1_LIBPRO <> 'S'
				U_GLALL001("Aten็ใo", "Protocolo ainda nใo aprovado!", "Execute os procedimentos para aprova็ใo do protocolo ou utilize a rotina de Libera็ใo para Descarregamento!")
				Return
			ElseIf ZM1->ZM1_STPROT == "F" .and. ZM1->ZM1_LIBPRO <> 'S'
				If Posicione("ZM8",1,xFilial("ZM8")+ZM1->ZM1_IDPROT,'ZM8_AVAL') <> 'A'
					U_GLALL001("Aten็ใo", "Protocolo nใo aprovado!", "Utilize a rotina de Libera็ใo para Descarregamento para em seguida descartar o tanque que gerou NFC!")
					Return
				EndIf
			EndIf

			// Djonata - 20210331
			// Inverte a grava็ใo dos campos armazenados na rotina de descarte e fechamento, pois o processo ้ executado invertido,
			// primeiro ้ pesado o leite bom, mas grava nos campos de descarte, depois ้ pesado o descarte, mas grava nos campos do leite bom,
			// foi solicitado para nใo alterar a sequ๊ncia desse processo

		/* If !Empty(ZM1->ZM1_USRDES)
			_nPesoIni := ZM1->ZM1_KGIDES
			_nPesoFim := ZM1->ZM1_KGFDES
			_nPDesIni := ZM1->ZM1_KGINI
			_nPDesFim := ZM1->ZM1_KGFIN
			RecLock('ZM1',.F.)
				ZM1->ZM1_KGIDES := _nPDesIni 
				ZM1->ZM1_KGFDES := _nPDesFim
				ZM1->ZM1_KGINI	:= _nPesoIni
				ZM1->ZM1_KGFIN	:= _nPesoFim
				ZM1->ZM1_KGBRT	:= _nPesoIni - _nPesoFim
			ZM1->(MsUnlock())
		EndIf */


		//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		//ณExecuta fun็ใo de apresenta็ใo da interface de pesagemณ
		//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		If SOFTLOCK("ZM1")
			LT019DET(cAlias, nReg, nOpc)
		EndIf
	EndIf
EndIf

Return





/*

ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
ฑฑษออออออออออัออออออออออหอออออออัออออออออออออออออออออหออออออัอออออออออออออปฑฑ
ฑฑบPrograma  ณLT019ALT   บAutor  ณMarcelo Joner      บ Data ณ  14/02/2020 บฑฑ
ฑฑฬออออออออออุออออออออออสอออออออฯออออออออออออออออออออสออออออฯอออออออออออออนฑฑ
ฑฑบDesc.     ณFun็ใo responsแvel pela funcionalidade de altera็ใo das     บฑฑ
ฑฑบ          ณpesagens existentes na rotina.                              บฑฑ
ฑฑฬออออออออออุออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออนฑฑ
ฑฑบUso       ณ Laticinio                                                  บฑฑ
ฑฑศออออออออออฯออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออผฑฑ
ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿
*/
User Function LT019ALT(cAlias, nReg, nOpc)

	Local cUsrAlt	:= GETMV("MV_ZL00003",, "")

//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
//ณExecuta demais regras, caso o usuแrio possua permissใo de altera็ใo de pesagensณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	If __cUserId $ cUsrAlt

		//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		//ณPermite alterar เ pesagem caso esteja finalizadaณ
		//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		If ZM1->ZM1_SITCON == "F" .AND. ALLTRIM(ZM1->ZM1_PROD) == "01010001"
			U_GLALL001("Aten็ใo", "A pesagem selecionada para altera็ใo estแ conciliada.", "ษ necessแrio desfazer a concilia็ใo antes de alterar.")
		Else

			If ZM1->ZM1_STATUS == "9"
			/*If ZM1->ZM1_STATUS == "1"
				U_GLALL001("Aten็ใo", "A pesagem selecionada para altera็ใo estแ em aberto.", "Somente ้ possํvel alterar pesagens que estejam finalizadas.")
			EndIf*/
			               
		//	If ZM1->ZM1_STATUS == "9"
				U_GLALL001("Aten็ใo", "A pesagem selecionada para altera็ใo estแ cancelada.", "Somente ้ possํvel alterar pesagens que estejam finalizadas.")
		//	EndIf
			
			Return
		Else
			//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
			//ณExecuta fun็ใo de apresenta็ใo da interface de pesagemณ
			//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
			If SOFTLOCK("ZM1")
				LT019DET(cAlias, nReg, nOpc)
			EndIf
		EndIf
	EndIf
Else
	//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	//ณAlerta o usuแrio em rela็ใo เ permissใo de utiliza็ใoณ
	//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	U_GLALL001("Aten็ใo", "O seu usuแrio nใo possui permissใo para utilizar estแ funcionalidade.", "Favor verificar เ questใo com o departamento de TI.")	
EndIf

Return





/*

ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
ฑฑษออออออออออัออออออออออหอออออออัออออออออออออออออออออหออออออัอออออออออออออปฑฑ
ฑฑบPrograma  ณLT019CAN   บAutor  ณMarcelo Joner      บ Data ณ  14/02/2020 บฑฑ
ฑฑฬออออออออออุออออออออออสอออออออฯออออออออออออออออออออสออออออฯอออออออออออออนฑฑ
ฑฑบDesc.     ณFun็ใo responsแvel pela funcionalidade de cancelamento das  บฑฑ
ฑฑบ          ณpesagens existentes na rotina.                              บฑฑ
ฑฑฬออออออออออุออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออนฑฑ
ฑฑบUso       ณ Laticinio                                                  บฑฑ
ฑฑศออออออออออฯออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออผฑฑ
ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿
*/
User Function LT019CAN(cAlias, nReg, nOpc)

	Local cUsrCan	:= GETMV("MV_ZL00004",, "")

//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
//ณExecuta demais regras, caso o usuแrio possua permissใo de cancelamento de pesagensณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	If __cUserId $ cUsrCan

		//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		//ณPermite cancelar เ pesagem caso nใo esteja canceladaณ
		//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		If ZM1->ZM1_STATUS == "9"
			U_GLALL001("Aten็ใo", "A pesagem selecionada para cancelamento jแ estแ cancelada.", "Somente ้ possํvel cancelar pesagens que nใo estejam canceladas.")
			Return
		Else
			//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
			//ณExecuta fun็ใo de apresenta็ใo da interface de pesagemณ
			//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
			If SOFTLOCK("ZM1")
				LT019DET(cAlias, nReg, nOpc)
			EndIf
		EndIf
	Else
		//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		//ณAlerta o usuแrio em rela็ใo เ permissใo de utiliza็ใoณ
		//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		U_GLALL001("Aten็ใo", "O seu usuแrio nใo possui permissใo para utilizar estแ funcionalidade.", "Favor verificar เ questใo com o departamento de TI.")
	EndIf

Return





/*

ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
ฑฑษออออออออออัออออออออออหอออออออัออออออออออออ`ออออออออหออออออัออออออออออออปฑฑ
ฑฑบPrograma  ณLT019DES  บAutor  ณMarcelo Joner        บ Data ณ 15/04/2020 บฑฑ
ฑฑฬออออออออออุออออออออออสอออออออฯออออออออออออออออออออสออออออฯอออออออออออออนฑฑ
ฑฑบDesc.     ณFun็ใo responsแvel pela funcionalidade Descarte presente no บฑฑ
ฑฑบ          ณbrowse da rotina de Pesagem.                                บฑฑ
ฑฑฬออออออออออุออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออนฑฑ
ฑฑบUso       ณ Laticinio                                                  บฑฑ
ฑฑศออออออออออฯออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออผฑฑ
ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿
*/
User Function LT019DES(cAlias, nReg, nOpc)

	Local lAchou	:= .F.
	Local cUsrDes	:= GETMV("MV_ZL00009",, "")

//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
//ณNใo permite utilizar funcionalidade se เ pesagem nใo estiver em abertoณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	If ZM1->ZM1_STATUS != "1"
		U_GLALL001("Aten็ใo", "A pesagem selecionada nใo encontra-se em aberto.", "O processo de descarte somente pode ser utilizado em pesagens que estejam em aberto.")
		Return
	Else
		//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		//ณExecuta demais regras, caso o usuแrio possua permissใo para utilizar o processo de descarteณ
		//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		If __cUserId $ cUsrDes

			//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
			//ณVerifica se existem anแlises de qualidade para เ pesagem com o status DESCARTEณ
			//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
			dbSelectArea("ZM3")
			ZM3->(dbSetOrder(1))
			ZM3->(dbGoTop())
			If ZM3->(dbSeek(xFilial("ZM3") + ZM1->ZM1_NUM))
				While ZM3->(!EOF()) .AND. ZM3->ZM3_FILIAL == xFilial("ZM3") .AND. ZM3->ZM3_NUM == ZM1->ZM1_NUM
					If ZM3->ZM3_STATUS == "D" .AND. EMPTY(ZM3->ZM3_USRDES)
						lAchou := .T.
						exit
					EndIf
					ZM3->(dbSkip())
				End
			EndIf

			// Djonata - 20210330
			// Verifico nas tabelas novas caso nใo tenha encontrado na antiga
			// mantive a antiga para compatibilidade com as pesagens jแ executadas
			If !lAchou
				dbSelectArea("ZM4")
				ZM4->(dbSetOrder(1))
				ZM4->(dbGoTop())
				If ZM4->(dbSeek(xFilial("ZM4") + ZM1->ZM1_NUM))
					While ZM4->(!EOF()) .AND. ZM4->ZM4_FILIAL == xFilial("ZM4") .AND. ZM4->ZM4_NUM == ZM1->ZM1_NUM
						If ZM4->ZM4_STATUS == "D" //.AND. EMPTY(ZM3->ZM3_USRDES)
							lAchou := .T.
							exit
						EndIf
						ZM4->(dbSkip())
					End
				EndIf

			EndIf

			//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
			//ณExecuta fun็ใo de apresenta็ใo da interface de pesagemณ
			//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
			If lAchou
				If SOFTLOCK("ZM1")
					LT019DET(cAlias, nReg, nOpc)
				EndIf
			Else
				//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				//ณImpede เ utiliza็ใo da funcionalidade, pois nใo existem ocorr๊ncias de descarteณ
				//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				U_GLALL001("Aten็ใo", "Nใo existem ocorr๊ncias de descarte para estแ pesagem.", "Somente ้ possํvel utilizar este processo sob pesagens que possuam incid๊ncia de descarte de produto.")
			EndIf
		Else
			//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
			//ณAlerta o usuแrio em rela็ใo เ permissใo de utiliza็ใoณ
			//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
			U_GLALL001("Aten็ใo", "O seu usuแrio nใo possui permissใo para utilizar estแ funcionalidade.", "Favor verificar เ questใo com o departamento de TI.")
		EndIf
	EndIf

Return





/*

ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
ฑฑษออออออออออัออออออออออหอออออออัออออออออออออ`ออออออออหออออออัออออออออออออปฑฑ
ฑฑบPrograma  ณLT019QUA  บAutor  ณMarcelo Joner        บ Data ณ 15/04/2020 บฑฑ
ฑฑฬออออออออออุออออออออออสอออออออฯออออออออออออออออออออสออออออฯอออออออออออออนฑฑ
ฑฑบDesc.     ณFun็ใo responsแvel por disponibilizar acesso เ funcionalida-บฑฑ
ฑฑบ          ณde de registro das anแlises de qualidade.                   บฑฑ
ฑฑฬออออออออออุออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออนฑฑ
ฑฑบUso       ณ Laticinio                                                  บฑฑ
ฑฑศออออออออออฯออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออผฑฑ
ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿
*/
User Function LT019QUA(cAlias, nReg, nOpc)

	Local lExeQlq	:= .F.
	Local cUsrQld	:= GETMV("MV_ZL00008",, "")

//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
//ณVerifica se o usuแrio tem permissใo para utilizar เ funcionalidade Qualidadeณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	If __cUserId $ cUsrQld
		lExeQlq := .T.
	EndIf

//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
//ณPermite cancelar เ pesagem caso nใo esteja canceladaณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	If ZM1->ZM1_STATUS == "9"
		U_GLALL001("Aten็ใo", "A pesagem selecionada para registro de anแlise de qualidade estแ cancelada.", "Somente ้ possํvel utilizar pesagens que nใo estejam canceladas.")
		Return
	ElseIf ZM1->ZM1_DATA > sToD('20210331')
		U_GLALL001("Aten็ใo", "Rotina invแlida.", "Utilizar a nova rotina de pesagem.")
		Return
	Else
		//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		//ณExecuta fun็ใo de apresenta็ใo da interface de pesagemณ
		//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		If SOFTLOCK("ZM1")
			U_LT019QLD(cAlias, nReg, nOpc, lExeQlq)
		EndIf
	EndIf

Return





/*

ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
ฑฑษออออออออออัออออออออออหอออออออัออออออออออออ`ออออออออหออออออัออออออออออออปฑฑ
ฑฑบPrograma  ณLT019CON  บAutor  ณMarcelo Joner        บ Data ณ 28/04/2020 บฑฑ
ฑฑฬออออออออออุออออออออออสอออออออฯออออออออออออออออออออสออออออฯอออออออออออออนฑฑ
ฑฑบDesc.     ณFun็ใo responsแvel por disponibilizar acesso เ funcionalida-บฑฑ
ฑฑบ          ณde referente เ concilia็ใo da pesagem.                      บฑฑ
ฑฑฬออออออออออุออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออนฑฑ
ฑฑบUso       ณ Laticinio                                                  บฑฑ
ฑฑศออออออออออฯออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออผฑฑ
ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿
*/
User Function LT019CON(cAlias, nReg, nOpc)

	Local lExeCon	:= .F.
	Local cUsrCon	:= GETMV("MV_ZL00010",, "")
	Local cUsrAlt	:= GETMV("MV_ZL00003",, "")

//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
//ณVerifica se o usuแrio tem permissใo para utilizar เ funcionalidade Concilia็ใoณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	If __cUserId $ cUsrCon
		lExeCon := .T.
	EndIf

	If !(__cUserId $ cUsrAlt) .AND. ZM1->ZM1_SITCON == "F"
		lExeCon := .F.
	EndIf

//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
//ณExecuta fun็ใo caso เ pesagem posicionada esteja fechadaณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	If ZM1->ZM1_STATUS == "2"

		//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		//ณExecuta fun็ใo de apresenta็ใo da interface de vinculo de coletasณ
		//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		If SOFTLOCK("ZM1")
			U_LT019TRP(cAlias, nReg, nOpc, lExeCon)
		EndIf
	Else
		//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		//ณAlerta o usuแrio pois เ pesagem nใo pode ser utilizadaณ
		//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		U_GLALL001("Aten็ใo", "A pesagem selecionada para concilia็ใo nใo encontra-se finalizada.", "Somente ้ possํvel utilizar pesagens que estejam finalizadas.")
		Return
	EndIf

Return





/*

ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
ฑฑษออออออออออัออออออออออหอออออออัออออออออออออ`ออออออออหออออออัออออออออออออปฑฑ
ฑฑบPrograma  ณLT019IMP  บAutor  ณMarcelo Joner        บ Data ณ 17/02/2020 บฑฑ
ฑฑฬออออออออออุออออออออออสอออออออฯออออออออออออออออออออสออออออฯอออออออออออออนฑฑ
ฑฑบDesc.     ณFun็ใo responsแvel pela execu็ใo da rotina de impressใo do  บฑฑ
ฑฑบ          ณticket de pesagem sob o registro posicionado no browse.     บฑฑ
ฑฑฬออออออออออุออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออนฑฑ
ฑฑบUso       ณ Laticinio                                                  บฑฑ
ฑฑศออออออออออฯออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออผฑฑ
ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿
*/
User Function LT019IMP(cAlias, nReg, nOpc)

	Do Case
	Case ZM1->ZM1_STATUS == "1"
		U_GLALL001("Aten็ใo", "A pesagem selecionada para impressใo estแ em aberto.", "Somente ้ possํvel imprimir pesagens que estejam finalizadas.")
		Return

	Case ZM1->ZM1_STATUS == "9"
		U_GLALL001("Aten็ใo", "A pesagem selecionada para impressใo estแ cancelada.", "Somente ้ possํvel imprimir pesagens que estejam finalizadas.")
		Return

	OtherWise
		U_LTREL038()
	EndCase

Return





/*

ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
ฑฑษออออออออออัออออออออออหอออออออัออออออออออออ`ออออออออหออออออัออออออออออออปฑฑ
ฑฑบPrograma  ณLT019DET  บAutor  ณMarcelo Joner        บ Data ณ 12/02/2020 บฑฑ
ฑฑฬออออออออออุออออออออออสอออออออฯออออออออออออออออออออสออออออฯอออออออออออออนฑฑ
ฑฑบDesc.     ณFun็ใo responsแvel pela disponibiliza็ใo da interface ao    บฑฑ
ฑฑบ          ณusuแrio em torno das principais funcionalidades da rotina.  บฑฑ
ฑฑฬออออออออออุออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออนฑฑ
ฑฑบUso       ณ Laticinio                                                  บฑฑ
ฑฑศออออออออออฯออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออผฑฑ
ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿
*/
Static Function LT019DET(cAlias, nReg, nOpc)

	Local aSize			:= {}
	Local aObjects		:= {}
	Local aInfo			:= {}
	Local aBotoes		:= {}
	Local aCpoCab		:= {}
	Local aAltCab		:= {}
	Local aCpoLog		:= {}
	Local aAltLog		:= {}
	Local aCpoCod		:= {}
	Local aAltCod		:= {}
	Local aCpoPes		:= {}
	Local aAltPes		:= {}
	Local aStrZM3		:= {{"OK"			, "C", 02						, 0},;
		{"ZM3_TANQUE"	, "C", TAMSX3("ZM3_TANQUE")[1]	, 0},;
		{"ZM3_DTANA"	, "D", TAMSX3("ZM3_DTANA")[1]	, 0},;
		{"ZM3_HRANA"	, "C", TAMSX3("ZM3_HRANA")[1]	, 0},;
		{"ZM3_NOMANA"	, "C", TAMSX3("ZM3_NOMANA")[1]	, 0},;
		{"ZM3_KGANT"	, "N", TAMSX3("ZM3_KGANT")[1]	, 0},;
		{"ZM3_KGPOS"	, "N", TAMSX3("ZM3_KGPOS")[1]	, 0},;
		{"ZM3_DTDES"	, "D", TAMSX3("ZM3_DTDES")[1]	, 0},;
		{"ZM3_HRDES"	, "C", TAMSX3("ZM3_HRDES")[1]	, 0},;
		{"ZM3_USRDES"	, "C", TAMSX3("ZM3_USRDES")[1]	, 0},;
		{"ZM3_NOMDES"	, "C", TAMSX3("ZM3_NOMDES")[1]	, 0},;
		{"ZM3_STATUS"	, "C", 10						, 0}}

	Local aVwQLD		:= {{"OK"			, "",""								, "@!"							},;
		{"ZM3_TANQUE"	, "", U_LTALLXSX3("ZM3_TANQUE")[1]	, U_LTALLXSX3("ZM3_TANQUE")[6]	},;
		{"ZM3_DTANA"	, "", U_LTALLXSX3("ZM3_DTANA")[1]	, U_LTALLXSX3("ZM3_DTANA")[6]	},;
		{"ZM3_HRANA"	, "", U_LTALLXSX3("ZM3_HRANA")[1]	, U_LTALLXSX3("ZM3_HRANA")[6]	},;
		{"ZM3_NOMANA"	, "", U_LTALLXSX3("ZM3_NOMANA")[1]	, U_LTALLXSX3("ZM3_NOMANA")[6]	},;
		{"ZM3_KGANT"	, "", U_LTALLXSX3("ZM3_KGANT")[1]	, U_LTALLXSX3("ZM3_KGANT")[6]	},;
		{"ZM3_KGPOS"	, "", U_LTALLXSX3("ZM3_KGPOS")[1]	, U_LTALLXSX3("ZM3_KGPOS")[6]	},;
		{"ZM3_DTDES"	, "", U_LTALLXSX3("ZM3_DTDES")[1]	, U_LTALLXSX3("ZM3_DTDES")[6]	},;
		{"ZM3_HRDES"	, "", U_LTALLXSX3("ZM3_HRDES")[1]	, U_LTALLXSX3("ZM3_HRDES")[6]	},;
		{"ZM3_NOMDES"	, "", U_LTALLXSX3("ZM3_NOMDES")[1]	, U_LTALLXSX3("ZM3_NOMDES")[6]	},;
		{"ZM3_STATUS"	, "", U_LTALLXSX3("ZM3_STATUS")[1]	, U_LTALLXSX3("ZM3_STATUS")[6]	}}

	Local nOpcao		:= 0
//Local nModelo		:= 3
	Local nRecZM1		:= ZM1->(RECNO())
	Local lF3			:= .F.
	Local lColumn		:= .F.
	Local lMemoria		:= .T.
	Local lNoFolder		:= .T.
	Local lProperty		:= .F.
	Local lPesMan		:= GETMV("MV_ZL00001",, .F.)
	Local lPesPsw		:= !lPesMan .AND. (ISINCALLSTACK("U_LT019ABE") .OR. ISINCALLSTACK("U_LT019FEC") .OR. ISINCALLSTACK("U_LT019ALT"))
	Local nX
	Private aGets[0]
	Private aGets1[0]
	Private aGets2[0]
	Private aGets3[0]
	Private aTela[0][0]
	Private aTela1[0][0]
	Private aTela2[0][0]
	Private aTela3[0][0]
	Private aTrocaF3 	:= {}

	Private lPeso		:= .F.
	Private lInverte	:= .F.
	Private lDescarte	:= ISINCALLSTACK("U_LT019DES")
	Private cMarca		:= GetMark()
	Private bCampo		:= {|nCPO| Field(nCPO)}
	Private cAliasQLD	:= GetNextAlias()

	Private VISUAL		:= IIF(nOpc == 2, .T., .F.)
	Private INCLUI		:= IIF(nOpc == 3, .T., .F.)
	Private ALTERA		:= IIF(nOpc == 4, .T., .F.)
	Private DELETA		:= .F.

//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
//ณMonta arrays com estruturas para MsMGetณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	aCpoCab := U_GLENCHOICE(1, cAlias, OemToAnsi("CADASTRAIS"))
	aAltCab := U_GLENCHOICE(2, cAlias, OemToAnsi("CADASTRAIS"))
	aCpoCod := U_GLENCHOICE(1, cAlias, OemToAnsi("CLIENTE\FORNECEDOR"))
	aAltCod := U_GLENCHOICE(2, cAlias, OemToAnsi("CLIENTE\FORNECEDOR"))
	aCpoLog := U_GLENCHOICE(1, cAlias, OemToAnsi("TRANSPORTE"))
	aAltLog := U_GLENCHOICE(2, cAlias, OemToAnsi("TRANSPORTE"))
	aCpoPes := U_GLENCHOICE(1, cAlias, OemToAnsi("PESAGEM"))
	aAltPes := U_GLENCHOICE(2, cAlias, OemToAnsi("PESAGEM"))

//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
//ณCria tabela temporแria referente as ANมLISES DE QUALIDADEณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	cTabTMP := CriaTrab(aStrZM3, .T.)
	dbUseArea(.T.,, cTabTMP ,cAliasQLD, .F., .F.)
	dbSelectArea(cAliasQLD)

//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
//ณComp๕e variaveis em mem๓ria referente เ tabela ZM1ณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	dbSelectArea(cAlias)
	RegToMemory(cAlias, INCLUI)

//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
//ณSendo inclusใo, solicita placa do veํculoณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	If INCLUI
		If !LT019SHW()
			Return
		EndIf
	Else

		//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		//ณAtribui aos campos em mem๓ria, os valores do registro da tabela posicionadoณ
		//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		dbSelectArea(cAlias)
		For nX := 1 TO FCount()
			M->&(Eval(bCampo, nX)) := FieldGet(nX)
		Next nX

		//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		//ณCarrega as informa็๕es de anแlises de qualidade para o alias temporแrioณ
		//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		dbSelectArea("ZM3")
		ZM3->(dbSetOrder(1))
		ZM3->(dbGoTop())
		If ZM3->(dbSeek(xFilial("ZM3") + M->ZM1_NUM))
			While ZM3->(!EOF()) .AND. ZM3->ZM3_FILIAL == xFilial("ZM3") .AND. ZM3->ZM3_NUM == M->ZM1_NUM
				RECLOCK(cAliasQLD, .T.)
				(cAliasQLD)->OK			:= ""
				(cAliasQLD)->ZM3_TANQUE	:= ZM3->ZM3_TANQUE
				(cAliasQLD)->ZM3_DTANA	:= ZM3->ZM3_DTANA
				(cAliasQLD)->ZM3_HRANA	:= ZM3->ZM3_HRANA
				(cAliasQLD)->ZM3_NOMANA	:= ZM3->ZM3_NOMANA
				(cAliasQLD)->ZM3_KGANT	:= ZM3->ZM3_KGANT
				(cAliasQLD)->ZM3_KGPOS	:= ZM3->ZM3_KGPOS
				(cAliasQLD)->ZM3_DTDES	:= ZM3->ZM3_DTDES
				(cAliasQLD)->ZM3_HRDES	:= ZM3->ZM3_HRDES
				(cAliasQLD)->ZM3_USRDES	:= ZM3->ZM3_USRDES
				(cAliasQLD)->ZM3_NOMDES	:= ZM3->ZM3_NOMDES
				(cAliasQLD)->ZM3_STATUS	:= IIF(ZM3->ZM3_STATUS == "A", "APROVADA", IIF(ZM3->ZM3_STATUS == "D", "DESCARTE", "VAZIO"))
				(cAliasQLD)->(MSUNLOCK())

				ZM3->(dbSkip())
			End
			(cAliasQLD)->(dbGoTop())
		Else
			_lDescarte := .F.
			dbSelectArea('ZM4')
			ZM4->(dbSetOrder(1))
			ZM4->(dbGoTop())
			If ZM4->(dbSeek(xFilial('ZM4')+M->ZM1_NUM))
				While ZM4->(!EOF()) .AND. ZM4->ZM4_FILIAL == xFilial("ZM4") .AND. ZM4->ZM4_NUM == M->ZM1_NUM
					dbSelectArea('ZM5')
					ZM5->(dbSetOrder(1))
					ZM5->(dbGoTop())
					If ZM5->(dbSeek(xFilial('ZM5')+M->ZM1_NUM+ZM4->ZM4_TANQUE))
						RECLOCK(cAliasQLD, .T.)
						(cAliasQLD)->OK			:= ""
						(cAliasQLD)->ZM3_TANQUE	:= ZM4->ZM4_TANQUE
						(cAliasQLD)->ZM3_DTANA	:= ZM1->ZM1_DATA
						(cAliasQLD)->ZM3_HRANA	:= ZM5->ZM5_HRANA
						(cAliasQLD)->ZM3_NOMANA	:= UsrFullName(ZM5->ZM5_USRANA)
						(cAliasQLD)->ZM3_STATUS	:= IIF(ZM4->ZM4_STATUS == "A", "APROVADA", IIF(ZM4->ZM4_STATUS == "D", "DESCARTE", IIF(ZM4->ZM4_STATUS == "P", "PROTOCOLO", "VAZIO")))

						If ZM4->ZM4_STATUS == 'D' .AND. !_lDescarte
							(cAliasQLD)->ZM3_KGANT	:= ZM1->ZM1_KGIDES
							(cAliasQLD)->ZM3_KGPOS	:= ZM1->ZM1_KGFDES
							(cAliasQLD)->ZM3_DTDES	:= ZM1->ZM1_DTDES
							(cAliasQLD)->ZM3_HRDES	:= ZM1->ZM1_HRDESC
							(cAliasQLD)->ZM3_USRDES	:= ZM1->ZM1_USRDES
							(cAliasQLD)->ZM3_NOMDES	:= UsrFullName(ZM1->ZM1_USRDES)
							_lDescarte := .T.
						EndIf

						(cAliasQLD)->(MSUNLOCK())
					EndIf
					ZM4->(dbSkip())
				EndDo

				(cAliasQLD)->(dbGoTop())
			EndIf
		EndIf

		//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		//ณSendo VISUALIZAวรO, adiciona funcionalidades em OUTRAS AวีESณ
		//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		If VISUAL
			AADD(aBotoes, {"UPDWARNING"	, {|| LT019LOG()}   , "Logs"})

			If ZM1->ZM1_STATUS == "9"
				AADD(aBotoes, {"nota"	, {|| LT019MTCAN(2)}, "Motivo"})
			EndIf
		EndIf
	EndIf

//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
//ณSeta teclas de atalho para pesagem via balan็a e manualณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	If ISINCALLSTACK("U_LT019ABE") .OR. ISINCALLSTACK("U_LT019FEC") .OR. ISINCALLSTACK("U_LT019DES")
		SetKey(VK_F5, {|| LT019INTBL()})

		//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		//ณAdiciona atalho para peso manual caso esteja ativado integra็ใo com balan็aณ
		//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		If lPesPsw .OR. ISINCALLSTACK("U_LT019DES")
			SetKey(VK_F8, {|| U_LT019KGM()})
		EndIf
	EndIf

//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
//ณCalcula tamanho\posicionamento da interfaceณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	aSize := MsAdvSize()
	AADD(aObjects, {100, 035, .T., .T.})
	AADD(aObjects, {100, 065, .T., .T.})
	aInfo := {aSize[1], aSize[2], aSize[3], aSize[4], 2, 2}
	aPosObj := MsObjSize(aInfo, aObjects, .T.)

//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
//ณDefini็ใo do Dialog e demais componentes da interfaceณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	DEFINE MSDIALOG oDlg TITLE cCadastro From aSize[7],0 to aSize[6],aSize[5] of oMainWnd PIXEL
	oDlg:bInit := {|| ENCHOICEBAR(oDlg,{|| IIF(LT019TOK(), (oDlg:End(), nOpcao := 1), )}, {|| (oDlg:End(), nOpcao := 2)},.F.,aBotoes)}

	//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	//ณExecuta regras para montagem do cabe็alho da pesagemณ
	//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	oGetCab := MSMGET():NEW(cAlias,nReg,nOpc, /*aCRA*/,/*cLetra*/,/*cTexto*/, aCpoCab, {aPosObj[1,1], aPosObj[1,2], aPosObj[1,3], aPosObj[1,4]}, aAltCab, 2,/*nColMens*/,/*cMensagem*/,'',oDlg, lF3, lMemoria, lColumn,/*caTela*/,lNoFolder,lProperty, /*aField*/, /*aFolder*/, .F., /*lNoMDIStretch*/,/*cTela*/)
	ZaGets1 := AClone(aGets)
	aTela1 := AClone(aTela)
	aGets  := {}
	aTela  := {}

	//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	//ณCria o Folder principal dos itens da pesagemณ
	//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	oFld := TFolder():New(aPosObj[2,1],aPosObj[2,2],{"&Cliente\Fornecedor", "&Transporte", "&Pesagem"},{},oDlg,,,,.T.,.F.,aPosObj[2,4]-aPosObj[2][2],aPosObj[2,3]-aPosObj[2][1],)

	//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	//ณCria regras para os campos da primeira aba do folder (Cli/For)ณ
	//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	oGetCod := MSMGET():NEW(cAlias,nReg,nOpc, /*aCRA*/,/*cLetra*/,/*cTexto*/, aCpoCod, {001,001,(oFld:aDialogs[1]:nClientHeight / 2)-2,(oFld:aDialogs[1]:nClientWidth / 2)-1}, aAltCod, 2,/*nColMens*/,/*cMensagem*/,'',oFld:aDialogs[1], lF3, lMemoria, lColumn,/*caTela*/,lNoFolder,lProperty, /*aField*/, /*aFolder*/, .F., /*lNoMDIStretch*/,/*cTela*/)
	aGets2 := AClone(aGets)
	aTela2 := AClone(aTela)
	aGets  := {}
	aTela  := {}

	//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	//ณCria regras para os campos da segunda aba do folder (Logistica)ณ
	//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	oGetLog := MSMGET():NEW(cAlias,nReg,nOpc, /*aCRA*/,/*cLetra*/,/*cTexto*/, aCpoLog, {001,001,(oFld:aDialogs[1]:nClientHeight / 2)-2,(oFld:aDialogs[1]:nClientWidth / 2)-1}, aAltLog, 2,/*nColMens*/,/*cMensagem*/,'',oFld:aDialogs[2], lF3, lMemoria, lColumn,/*caTela*/,lNoFolder,lProperty, /*aField*/, /*aFolder*/, .F., /*lNoMDIStretch*/,/*cTela*/)
	aGets3 := AClone(aGets)
	aTela3 := AClone(aTela)
	aGets  := {}
	aTela  := {}

	//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	//ณCria regras para os campos da terceira aba do folder (Pesagem)ณ
	//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	oGetPes := MSMGET():NEW(cAlias,nReg,nOpc, /*aCRA*/,/*cLetra*/,/*cTexto*/, aCpoPes, {001,001,(oFld:aDialogs[3]:nClientHeight / 2)-2,130}, aAltPes, 2,/*nColMens*/,/*cMensagem*/,'',oFld:aDialogs[3], lF3, lMemoria, .T.,/*caTela*/,lNoFolder,lProperty, /*aField*/, /*aFolder*/, .F., /*lNoMDIStretch*/,/*cTela*/)
	aGets4 := AClone(aGets)
	aTela4 := AClone(aTela)
	aGets  := {}
	aTela  := {}

	//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	//ณComponentes referentes hแ integra็ใo com balan็a e peso via senhaณ
	//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	oPeso1 := TBtnBmp2():New(003,260,30,30, 'CARGA', , ,  , {|| IIF(ISINCALLSTACK("U_LT019ABE") .OR. ISINCALLSTACK("U_LT019DES"), LT019INTBL(),)} ,oFld:aDialogs[3], "Obter Peso", , .T.)
	oPeso2 := TBtnBmp2():New(003,330,30,30, 'CHAVE2', , , , {|| IIF(lPesPsw .OR. ISINCALLSTACK("U_LT019DES"), U_LT019KGM("E"),)} ,oFld:aDialogs[3], "Pesagem Manual", , .T.)

	oPeso3 := TBtnBmp2():New(070,260,30,30, 'CARGA', , ,  , {|| IIF(ISINCALLSTACK("U_LT019FEC"), LT019INTBL(),)} ,oFld:aDialogs[3], "Obter Peso", , .T.)
	oPeso4 := TBtnBmp2():New(070,330,30,30, 'CHAVE2', , , , {|| IIF(lPesPsw, U_LT019KGM("S"),)} ,oFld:aDialogs[3], "Pesagem Manual", , .T.)

	//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	//ณGrid de apresenta็ใo de informa็๕es de anแlises de qualidadeณ
	//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	oFldQld := TFolder():New(001,200,{"Qualidade"},{},oFld:aDialogs[3],,,,.T.,.F.,aPosObj[2,4]-204,(oFld:aDialogs[3]:nClientHeight / 4)-2,)
	oMarQld := MsSelect():New(cAliasQLD,IIF(lDescarte, "OK", ""),"",aVwQLD,@lInverte,@cMarca,{001,001,(oFldQld:aDialogs[1]:nClientHeight / 2),(oFldQld:aDialogs[1]:nClientWidth / 2)},,,oFldQld:aDialogs[1])
	oMarQld:oBrowse:lHasMark     := .F.
	oMarQld:oBrowse:lCanAllMark  := .F.
	oMarQld:bMark                := {|| IIF(lDescarte, LT019MRK(), )}

	//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	//ณSendo abertura com placa jแ existente, foca na sessใo de transporteณ
	//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	If INCLUI
		If lPeso
			If EMPTY(M->ZM1_CODVEI)
				oFld:SetOption(1)
				SetFocus(oGetPes:hWnd)
			Else
				oFld:SetOption(2)
				SetFocus(oGetPes:hWnd)
			EndIf

		Else
			SetFocus(oGetCab:aEntryCtrls[4]:hWnd)
		EndIf

		//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		//ณSendo FECHAMENTO ou DESCARTE, foca na sessใo de pesagemณ
		//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	ElseIf ISINCALLSTACK("U_LT019FEC") .OR. ISINCALLSTACK("U_LT019DES")
		oFld:SetOption(3)
	EndIf

	ACTIVATE MSDIALOG oDlg

//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
//ณRemove defini็๕es de teclas de atalho da rotinaณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	SetKey(VK_F5, Nil)
	SetKey(VK_F8, Nil)

//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
//ณConfirmando เ interface, executa fun็ใo de manipula็ใo das informa็๕es na base de dadosณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	If nOpcao == 1
		LT019GRV()
	Else
		//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		//ณCaso cancelou เ abertura de uma nova pesagem, executa rollback no sequ๊ncialณ
		//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		If ISINCALLSTACK("U_LT019ABE")
			ZM1->(ROLLBACKSX8())
			ZM1->(dbGoTo(nRecZM1))
		EndIf
	EndIf

//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
//ณFecha alias temporแrio utilizado na interfaceณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	If Select(cAliasQLD) > 0
		(cAliasQLD)->(dbCloseArea())
	EndIf

Return





/*

ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
ฑฑษออออออออออัออออออออออหอออออออัออออออออออออ`ออออออออหออออออัออออออออออออปฑฑ
ฑฑบPrograma  ณLT019TOK  บAutor  ณMarcelo Joner        บ Data ณ 13/02/2020 บฑฑ
ฑฑฬออออออออออุออออออออออสอออออออฯออออออออออออออออออออสออออออฯอออออออออออออนฑฑ
ฑฑบDesc.     ณFun็ใo de valida็ใo geral na confirma็ใo da interface da    บฑฑ
ฑฑบ          ณrotina de pesagens.                                         บฑฑ
ฑฑฬออออออออออุออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออนฑฑ
ฑฑบUso       ณ Laticinio                                                  บฑฑ
ฑฑศออออออออออฯออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออผฑฑ
ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿
*/
Static Function LT019TOK()

	Local lRet		:= .T.
	Local aArea		:= GetArea()
	Local cPrdLin	:= GETMV("MV_ZL00005",, "")
	Local cPrdTan	:= GETMV("MV_ZL00011",, "")

//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
//ณExecuta regras, caso seja ABERTURA ou ALTERAวรO da pesagemณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	If INCLUI .OR. ALTERA

		//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		//ณCaso campos obrigat๓rios nใo estejam informados, nใo permite prosseguirณ
		//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		If !OBRIGATORIO(aGets1, aTela1) .OR. !OBRIGATORIO(aGets2, aTela2) .OR. !OBRIGATORIO(aGets3, aTela3) .OR. !OBRIGATORIO(aGets4, aTela4)
			Return .F.
		EndIf

		//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		//ณAplica valida็๕es na confirma็ใo de abertura da pesagemณ
		//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		If ISINCALLSTACK("U_LT019ABE")

			//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
			//ณAplica valida็๕es sob o peso de entradaณ
			//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
			If M->ZM1_KGINI <= 0
				U_GLALL001("Aten็ใo", "O peso de entrada nใo foi informado.", "Para confirmar เ abertura da pesagem, deve ser informado o peso de entrada do veํculo.")
				Return .F.
			EndIf
		EndIf

		//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		//ณAplica valida็๕es sob o peso de saํdaณ
		//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		If ISINCALLSTACK("U_LT019FEC")
			If M->ZM1_KGFIN <= 0
				U_GLALL001("Aten็ใo", "O peso de saํda nใo foi informado.", "Para confirmar o fechamento da pesagem, deve ser informado o peso de saํda do veํculo.")
				Return .F.
			EndIf
		EndIf

		//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		//ณAplica valida็๕es sob เ informa็ใo do n๚mero de tanques do veํculoณ
		//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		If ALLTRIM(M->ZM1_PROD) $ cPrdTan .AND. M->ZM1_NRTNQ == 0
			U_GLALL001("Aten็ใo", "Nใo foi informado n๚mero de tanques do veํculo.", "Favor informar o n๚mero de tanques do veํculo vinculado เ estแ carga.")
			Return .F.
		EndIf

		//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		//ณAplica valida็ใo em rela็ใo เ obrigatoriedade da linha de coleta da cargaณ
		//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		If EMPTY(M->ZM1_NFCOM)
			If (M->ZM1_TIPO == "1" .AND. ISINCALLSTACK("U_LT019FEC") .AND. ALLTRIM(M->ZM1_PROD) $ cPrdLin .AND. EMPTY(M->ZM1_CODLIN))
				U_GLALL001("Aten็ใo", "Nใo foi informada เ linha de coleta da carga.", "Favor informar เ linha de coleta vinculada เ estแ carga.")
				Return .F.
			EndIf
		EndIf

		//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		//ณAlerta o usuแrio เ respeito de inconsist๊ncia na informa็ใo dos campos de NOTA FISCAL e SษRIEณ
		//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		If M->ZM1_TIPO == "1" .AND. ISINCALLSTACK("U_LT019FEC") .AND. ((EMPTY(M->ZM1_NFCOM) .AND. !EMPTY(M->ZM1_SRCOM)) .OR. (!EMPTY(M->ZM1_NFCOM) .AND. EMPTY(M->ZM1_SRCOM)))
			U_GLALL001("Aten็ใo", "Os campos referentes เ Nota Fiscal e S้rie do fornecedor estใo inconsistentes.", "ษ necessแrio que seja informado o n๚mero e s้rie da nota fiscal do fornecedor vinculado เ pesagem de entrada.")
			Return .F.
		EndIf

		IF M->ZM1_TIPO == "2" .AND. ISINCALLSTACK("U_LT019FEC")
			Return U_LT019TP()
		EndIf

		IF ISINCALLSTACK("U_LT019FEC")
			If Aviso("Aten็ใo", "Confirma o Fechamento da pesagem da placa " + SUBSTR(M->ZM1_PLACA,1,3) + "-" + SUBSTR(M->ZM1_PLACA,4,4) + "?" , {"&Sim", "&Nใo"}, 2) == 2
				Return .F.

			EndIf
		ENDIF

		//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		//ณExecuta fun็ใo de avalia็ใo das informa็๕es de peso da carga e composi็ใo do TIPO da pesagemณ
		//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		U_LTMOV9TP()
	EndIf

//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
//ณSendo CANCELAMENTO da pesagem, apresenta interface para informar o motivoณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	If ISINCALLSTACK("U_LT019CAN")
		lRet := LT019MTCAN(4)
	EndIf

	RestArea(aArea)

Return lRet





/*

ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
ฑฑษออออออออออัออออออออออหอออออออัออออออออออออ`ออออออออหออออออัออออออออออออปฑฑ
ฑฑบPrograma  ณLT019MTCAN  บAutor ณMarcelo Joner       บ Data ณ 13/02/2020 บฑฑ
ฑฑฬออออออออออุออออออออออสอออออออฯออออออออออออออออออออสออออออฯอออออออออออออนฑฑ
ฑฑบDesc.     ณFun็ใo responsแvel pela apresenta็ใo de interface secundแriaบฑฑ
ฑฑบ          ณonde deverแ ser informado o motivo referente ao cancelamentoบฑฑ
ฑฑบ          ณda pesagem.                                                 บฑฑ
ฑฑฬออออออออออุออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออนฑฑ
ฑฑบUso       ณ Laticinio                                                  บฑฑ
ฑฑศออออออออออฯออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออผฑฑ
ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿
*/
Static Function LT019MTCAN(nOpc)

	Local aArea			:= GetArea()
	Local aCpoCad 		:= {'NOUSER', 'ZM1_OBSCAN'}
	Local aAltCad 		:= {'ZM1_OBSCAN'}
	Local aSize			:= {}
	Local aObjects		:= {}
	Local aInfo			:= {}
	Local lRet			:= .T.
	Local lF3			:= .F.
	Local lColumn		:= .F.
	Local lMemoria		:= .T.
	Local lNoFolder		:= .T.
	Local lProperty		:= .F.
	Local cCadOld		:= cCadastro

	Default nOpc		:= 1

	Private aGets[0]
	Private aTela[0][0]

//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
//ณSendo Visualiza็ใo do motivo de cancelamento, apresenta demais campos para visualiza็ใoณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	If nOpc == 2
		cCadastro := "Cancelamento da Pesagem"
		aCpoCad := {'NOUSER', 'ZM1_OBSCAN', 'ZM1_USRCAN', 'ZM1_NOMCAN', 'ZM1_DTCAN', 'ZM1_HRCAN'}
		aAltCad := {'ZM1_OBSCAN', 'ZM1_USRCAN', 'ZM1_NOMCAN', 'ZM1_DTCAN', 'ZM1_HRCAN'}
	Else
		cCadastro := "Cancelar Pesagem"
	EndIf

//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
//ณCalcula tamanho\posicionamento da interfaceณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	aSize := MsAdvSize(.T.)
	AADD(aObjects, {100, 100, .T., .T.})
	aInfo := {aSize[1], aSize[2], aSize[3], aSize[4], 2, 2}
	aPosObj := MsObjSize(aInfo, aObjects, .T.)

//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
//ณDeclara็ใo do dialog e demais componentes da interface secundแriaณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	oDlgLog := MSDialog():New(089,232,IIF(nOpc == 4, 220, 260),920,cCadastro,,,.F.,,,,,,.T.,,,.T. )
	oDlgLog:bInit := {|| ENCHOICEBAR(oDlgLog, {|| If(LT019VLCAN(), (lRet := .T., oDlgLog:End()),)}, {|| (lRet := .F., oDlgLog:End())}, .F., {})}

	//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	//ณ Cabe็alho da interface de Logณ
	//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	oGetCad := MSMGET():NEW("ZM1",0, nOpc, /*aCRA*/,/*cLetra*/,/*cTexto*/, aCpoCad, {aPosObj[1][1], 001, (oDlgLog:nClientHeight / 2)-15,(oDlgLog:nClientWidth / 2)-5}, aAltCad, 2,/*nColMens*/,/*cMensagem*/,'',oDlgLog, lF3, lMemoria, lColumn,/*caTela*/,lNoFolder,lProperty, /*aField*/, /*aFolder*/, .F., /*lNoMDIStretch*/,/*cTela*/)

	oDlgLog:Activate(,,,.T.)

	cCadastro := cCadOld

	RestArea(aArea)

Return lRet





/*

ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
ฑฑษออออออออออัออออออออออหอออออออัออออออออออออ`ออออออออหออออออัออออออออออออปฑฑ
ฑฑบPrograma  ณLT019VLCAN บAutor  ณMarcelo Joner       บ Data ณ 13/02/2020 บฑฑ
ฑฑฬออออออออออุออออออออออสอออออออฯออออออออออออออออออออสออออออฯอออออออออออออนฑฑ
ฑฑบDesc.     ณFun็ใo responsแvel pela valida็ใo geral da interface secun- บฑฑ
ฑฑบ          ณdแria de cancelamento de pesagens.                          บฑฑ
ฑฑฬออออออออออุออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออนฑฑ
ฑฑบUso       ณ Laticinio                                                  บฑฑ
ฑฑศออออออออออฯออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออผฑฑ
ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿
*/
Static Function LT019VLCAN()

	Local lRet	:= .T.

//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
//ณCampos obrigat๓rios do cabe็alhoณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	If !OBRIGATORIO(aGets, aTela)
		Return .F.
	Else
		//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		//ณValida เ observa็ใo informada pelo usuแrioณ
		//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		If Len(ALLTRIM(M->ZM1_OBSCAN)) <= 15
			U_GLALL001("Aten็ใo", "A observa็ใo informada ้ invแlida.", "Favor informar uma observa็ใo com mais de 15 caracteres referente ao cancelamento da pesagem.")
			Return .F.
		EndIf
	EndIf

Return lRet





/*

ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
ฑฑษออออออออออัออออออออออหอออออออัออออออออออออ`ออออออออหออออออัออออออออออออปฑฑ
ฑฑบPrograma  ณLT019GRV  บAutor  ณMarcelo Joner        บ Data ณ 13/02/2020 บฑฑ
ฑฑฬออออออออออุออออออออออสอออออออฯออออออออออออออออออออสออออออฯอออออออออออออนฑฑ
ฑฑบDesc.     ณFun็ใo responsแvel pela manipula็ใo das informa็๕es referen-บฑฑ
ฑฑบ          ณtes as pesagens junto เ base de dados.                      บฑฑ
ฑฑฬออออออออออุออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออนฑฑ
ฑฑบUso       ณ Laticinio                                                  บฑฑ
ฑฑศออออออออออฯออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออผฑฑ
ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿
*/
Static Function LT019GRV()

	Local nI		:= 0
	Local aArea		:= GetArea()

	Do Case

		//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		//ณRegras de grava็ใo da ABERTURA da pesagemณ
		//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	Case ISINCALLSTACK("U_LT019ABE")
		BEGIN TRANSACTION
			dbSelectArea("ZM1")
			RECLOCK("ZM1", .T.)
			For nI := 1 To FCount()
				If FieldName(nI) == "ZM1_FILIAL"
					FieldPut(nI, xFilial("ZM1"))
				Else
					If FieldName(nI) == "ZM1_STATUS"
						FieldPut(nI, "1")
					Else
						FieldPut(nI, M->&(FieldName(nI)))
					EndIf
				EndIf
			Next nI
			ZM1->(MSUNLOCK())

			ZM1->(CONFIRMSX8())

			//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
			//ณExecuta fun็ใo de verifica็ใo de incid๊ncia de anแlise de qualidade sob เ pesagemณ
			//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
			LT019STQLD()
		END TRANSACTION



		//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		//ณRegras de grava็ใo do FECHAMENTO da pesagemณ
		//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	Case ISINCALLSTACK("U_LT019FEC")
		BEGIN TRANSACTION
			dbSelectArea("ZM1")
			RECLOCK("ZM1", .F.)
			For nI := 1 To FCount()
				If FieldName(nI) == "ZM1_FILIAL"
					FieldPut(nI, xFilial("ZM1"))
				Else
					If FieldName(nI) == "ZM1_STATUS"
						FieldPut(nI, "2")
					Else
						FieldPut(nI, M->&(FieldName(nI)))
					EndIf
				EndIf
			Next nI
			ZM1->(MSUNLOCK())

			//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
			//ณExecuta fun็ใo de verifica็ใo de incid๊ncia de anแlise de qualidade sob เ pesagemณ
			//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
			LT019STQLD()

			// Djonata - 20210331
			// Inverte a grava็ใo dos campos armazenados na rotina de descarte e fechamento, pois o processo ้ executado invertido,
			// primeiro ้ pesado o leite bom, mas grava nos campos de descarte, depois ้ pesado o descarte, mas grava nos campos do leite bom,
			// foi solicitado para nใo alterar a sequ๊ncia desse processo

			If !Empty(ZM1->ZM1_USRDES)
				_nPesoIni := ZM1->ZM1_KGIDES
				_nPesoFim := ZM1->ZM1_KGFDES
				_nPDesIni := ZM1->ZM1_KGINI
				_nPDesFim := ZM1->ZM1_KGFIN
				RecLock('ZM1',.F.)
				ZM1->ZM1_KGIDES := _nPDesIni
				ZM1->ZM1_KGFDES := _nPDesFim
				ZM1->ZM1_KGINI	:= _nPesoIni
				ZM1->ZM1_KGFIN	:= _nPesoFim
				ZM1->ZM1_KGBRT	:= _nPesoIni - _nPesoFim
				ZM1->(MsUnlock())
			EndIf
		END TRANSACTION

		If Aviso("Aten็ใo", "Deseja realizar เ impressใo do ticket de pesagem?", {"&Sim", "&Nใo"}, 2) == 1
			If GETMV("MX_IMPTICK",, "") = "LASER"
				U_LTREL047()
			else
				U_LTREL038()
			EndIf
		EndIf



		//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		//ณRegras de grava็ใo de ALTERAวรO ou DESCARTE da pesagemณ
		//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	Case ISINCALLSTACK("U_LT019ALT") .OR. ISINCALLSTACK("U_LT019DES")
		BEGIN TRANSACTION
			dbSelectArea("ZM1")
			RECLOCK("ZM1", .F.)
			For nI := 1 To FCount()
				If FieldName(nI) == "ZM1_FILIAL"
					FieldPut(nI, xFilial("ZM1"))
				Else
					FieldPut(nI, M->&(FieldName(nI)))
				EndIf
			Next nI
			ZM1->(MSUNLOCK())

			//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
			//ณSendo execu็ใo atrav้s da funcionalidade DESCARTE, atualiza registros de anแlises de qualidadeณ
			//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
			If ISINCALLSTACK("U_LT019DES")
				dbSelectArea(cAliasQLD)
				(cAliasQLD)->(dbGoTop())
				While (cAliasQLD)->(!EOF())
					dbSelectArea("ZM3")
					ZM3->(dbSetOrder(1))
					ZM3->(dbGoTop())
					If ZM3->(dbSeek(xFilial("ZM3") + ZM1->ZM1_NUM + (cAliasQLD)->ZM3_TANQUE))
						RECLOCK("ZM3", .F.)
						ZM3->ZM3_KGANT	:= (cAliasQLD)->ZM3_KGANT
						ZM3->ZM3_KGPOS	:= (cAliasQLD)->ZM3_KGPOS
						ZM3->ZM3_DTDES	:= (cAliasQLD)->ZM3_DTDES
						ZM3->ZM3_HRDES	:= (cAliasQLD)->ZM3_HRDES
						ZM3->ZM3_USRDES	:= (cAliasQLD)->ZM3_USRDES
						ZM3->ZM3_NOMDES	:= (cAliasQLD)->ZM3_NOMDES
						ZM3->(MSUNLOCK())
					ElseIf !Empty((cAliasQLD)->ZM3_KGANT)
						RecLock('ZM1',.F.)
						ZM1->ZM1_KGIDES := (cAliasQLD)->ZM3_KGANT
						ZM1->ZM1_KGFDES := (cAliasQLD)->ZM3_KGPOS
						ZM1->ZM1_USRDES := (cAliasQLD)->ZM3_USRDES
						ZM1->ZM1_DTDES  := (cAliasQLD)->ZM3_DTDES
						ZM1->ZM1_HRDESC := (cAliasQLD)->ZM3_HRDES
						ZM1->(MsUnlock())
					EndIf
					(cAliasQLD)->(dbSkip())
				End
			EndIf

			//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
			//ณSendo ALTERAวรO, executa fun็ใo de verifica็ใo de incid๊ncia de anแlise de qualidade sob เ pesagemณ
			//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
			If ISINCALLSTACK("U_LT019ALT")
				//LT019STQLD()
				dbSelectArea("ZM1")
				RECLOCK("ZM1", .F.)
				ZM1->ZM1_LTVAZ 	:= 0
				ZM1->ZM1_FATCON := 0
				ZM1->ZM1_LTBRT  := 0
				ZM1->ZM1_LTDIF  := 0

				ZM1->(MSUNLOCK())
			EndIf
		END TRANSACTION



		//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		//ณRegras de grava็ใo do CANCELAMENTO da pesagemณ
		//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	Case ISINCALLSTACK("U_LT019CAN")
		BEGIN TRANSACTION
			dbSelectArea("ZM1")
			RECLOCK("ZM1", .F.)
			ZM1->ZM1_USRCAN := __cUserId
			ZM1->ZM1_NOMCAN := cUserName
			ZM1->ZM1_DTCAN  := dDataBase
			ZM1->ZM1_HRCAN  := SUBSTR(GetRmtTime(), 1, 5)
			ZM1->ZM1_OBSCAN := M->ZM1_OBSCAN
			ZM1->ZM1_STATUS := "9"
			ZM1->(MSUNLOCK())
		END TRANSACTION

	EndCase

	RestArea(aArea)

Return





/*

ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
ฑฑษออออออออออัออออออออออหอออออออัออออออออออออ`ออออออออหออออออัออออออออออออปฑฑ
ฑฑบPrograma  ณLT019STQLD บAutor  ณMarcelo Joner       บ Data ณ 15/04/2020 บฑฑ
ฑฑฬออออออออออุออออออออออสอออออออฯออออออออออออออออออออสออออออฯอออออออออออออนฑฑ
ฑฑบDesc.     ณFun็ใo responsแvel pela atualiza็ใo do campo de controle do บฑฑ
ฑฑบ          ณstatus do processo de anแlise de qualidade da pesagem.      บฑฑ
ฑฑฬออออออออออุออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออนฑฑ
ฑฑบUso       ณ Laticinio                                                  บฑฑ
ฑฑศออออออออออฯออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออผฑฑ
ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿
*/
Static Function LT019STQLD()

	Local aArea		:= GetArea()

//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
//ณPosiciona no cadastro do produto vinculado hแ pesagemณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	dbSelectArea("SB1")
	SB1->(dbSetOrder(1))
	SB1->(dbGoTop())
	If SB1->(dbSeek(xFilial("SB1") + ZM1->ZM1_PROD))

		//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		//ณHavendo vinculo de Tipo de Anแlise ao produto, atualiza o campo de controle do status de pesagemณ
		//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		If !EMPTY(SB1->B1_X_TPANA)
			RECLOCK("ZM1", .F.)
			ZM1->ZM1_SITQLD := "P"
			ZM1->(MSUNLOCK())
		Else
			//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
			//ณNใo havendo Tipo de Anแlise ao produto, garante exclusใo dos registros de qualidadeณ
			//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
			dbSelectArea("ZM3")
			ZM3->(dbSetOrder(1))
			ZM3->(dbGoTop())
			If ZM3->(dbSeek(xFilial("ZM3") + ZM1->ZM1_NUM))
				While ZM3->(!EOF()) .AND. ZM3->ZM3_FILIAL == xFilial("ZM3") .AND. ZM3->ZM3_NUM == ZM1->ZM1_NUM
					RECLOCK("ZM3", .F.)
					ZM3->(DBDELETE())
					ZM3->(MSUNLOCK())

					ZM3->(dbSkip())
				End
			EndIf

			//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
			//ณLimpa o campo de controle do status da anแlise de qualidade da pesagemณ
			//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
			RECLOCK("ZM1", .F.)
			ZM1->ZM1_SITQLD := ""
			ZM1->(MSUNLOCK())
		EndIf
	EndIf

	RestArea(aArea)

Return





/*

ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
ฑฑษออออออออออัออออออออออหอออออออัออออออออออออ`ออออออออหออออออัออออออออออออปฑฑ
ฑฑบPrograma  ณLT019VCF  บAutor  ณMarcelo Joner        บ Data ณ 12/02/2020 บฑฑ
ฑฑฬออออออออออุออออออออออสอออออออฯออออออออออออออออออออสออออออฯอออออออออออออนฑฑ
ฑฑบDesc.     ณFun็ใo de valida็ใo vinculada aos campos de c๓digo e loja doบฑฑ
ฑฑบ          ณcliente\fornecedor na rotina de pesagens.                   บฑฑ
ฑฑฬออออออออออุออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออนฑฑ
ฑฑบUso       ณ Laticinio                                                  บฑฑ
ฑฑศออออออออออฯออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออผฑฑ
ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿
*/
User Function LT019VCF(cCampo)

	Local lRet	:= .T.
	Local cPrdSer := GETMV("MV_ZL00013",, "")
//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
//ณSendo ENTRADA, valida dados de FORNECEDORณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	If M->ZM1_TIPO == "1" .OR. (ALLTRIM(M->ZM1_PROD) $ cPrdSer)
		If cCampo == "ZM1_CLIFOR"
			M->ZM1_LOJA := ""
		EndIf
		dbSelectArea("SA2")
		SA2->(dbSetOrder(1))
		SA2->(dbGoTop())
		If SA2->(dbSeek(xFilial("SA2") + M->ZM1_CLIFOR + IIF(!EMPTY(M->ZM1_LOJA), M->ZM1_LOJA, "")))
			M->ZM1_LOJA := SA2->A2_LOJA
			M->ZM1_NOME := SA2->A2_NOME

			//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
			//ณVerifica se o mesmo estแ presente em Produtores X Linha para obter o Transportadorณ
			//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
			dbSelectArea("ZL1")
			ZL1->(dbSetOrder(4))
			ZL1->(dbGoTop())
			If ZL1->(dbSeek(xFilial("ZL1") + SA2->A2_COD + SA2->A2_LOJA))
				dbSelectArea("ZL0")
				ZL0->(dbSetOrder(1))
				ZL0->(dbGoTop())
				If ZL0->(dbSeek(xFilial("ZL0") + ZL1->ZL1_COD))
					M->ZM1_TRANSP := ZL0->ZL0_TRANSP
					M->ZM1_DTRANS := ZL0->ZL0_NOMTRP
				EndIf
			EndIf
		Else
			lRet := .F.
			U_GLALL001("Aten็ใo", "O fornecedor informado ้ invแlido.", "Favor verificar os dados informados.")
		EndIf
	Else
		//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		//ณSendo SAอDA, valida dados de CLIENTEณ
		//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		dbSelectArea("SA1")
		SA1->(dbSetOrder(1))
		SA1->(dbGoTop())
		If SA1->(dbSeek(xFilial("SA1") + M->ZM1_CLIFOR + IIF(!EMPTY(M->ZM1_LOJA), M->ZM1_LOJA, "")))
			M->ZM1_LOJA := SA1->A1_LOJA
			M->ZM1_NOME := SA1->A1_NOME
		Else
			lRet := .F.
			U_GLALL001("Aten็ใo", "O cliente informado ้ invแlido.", "Favor verificar os dados informados.")
		EndIf
	EndIf

Return lRet

/*

ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
ฑฑษออออออออออัออออออออออหอออออออัออออออออออออ`ออออออออหออออออัออออออออออออปฑฑ
ฑฑบPrograma  ณLT019MED  บAutor  ณMarcelo Joner        บ Data ณ 12/02/2020 บฑฑ
ฑฑฬออออออออออุออออออออออสอออออออฯออออออออออออออออออออสออออออฯอออออออออออออนฑฑ
ฑฑบDesc.     ณFun็ใo vinculada as regras de modo de edi็ใo de algunas     บฑฑ
ฑฑบ          ณcampos da rotina de pesagens.                               บฑฑ
ฑฑฬออออออออออุออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออนฑฑ
ฑฑบUso       ณ Laticinio                                                  บฑฑ
ฑฑศออออออออออฯออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออผฑฑ
ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿
*/
User Function LT019MED(cCampo)

	Local lRet		:= .F.

	Default cCampo	:= ""

	Do Case
	Case cCampo == "ZM1_PLACA"
		lRet := IIF(EMPTY(M->ZM1_CODVEI) .AND. !(ISINCALLSTACK("U_LT019ABE")), .T., IIF(ISINCALLSTACK("U_LT019FEC"),.T., .F.) .AND. IIF(ISINCALLSTACK("U_LT019ALT"),.T., .F.))

	Case cCampo == "ZM1_CODVEI"
		lRet := IIF(ISINCALLSTACK("U_LT019ALT"),.T., .F.)

	Case cCampo == "ZM1_NOMMOT"
		lRet := EMPTY(M->ZM1_CODMOT)

	Case cCampo == "ZM1_TIPO"
		lRet := IIF(ISINCALLSTACK("U_LT019ALT"), GETMV("MV_ZL00003",, .F.), .F.)

	Case cCampo == "ZM1_PROD"
		lRet := IIF(ISINCALLSTACK("U_LT019ALT"), GETMV("MV_ZL00003",, .F.), .F.) .OR. ISINCALLSTACK("U_LT019ABE")

	Case cCampo == "ZM1_CODLIN"
		lRet := !EMPTY(M->ZM1_TRANSP)

	Case cCampo == "ZM1_NRTNQ"
		lRet := ALLTRIM(M->ZM1_PROD) $ ALLTRIM(GETMV("MV_ZL00011",, ""))
		M->ZM1_NRTNQ := IIF(lRet, M->ZM1_NRTNQ, 0)

	Case cCampo == "ZM1_KGINI"
		lRet := IIF(ISINCALLSTACK("U_LT019ABE"), GETMV("MV_ZL00001",, .F.), .F.)

	Case cCampo == "ZM1_KGFIN"
		lRet := IIF(ISINCALLSTACK("U_LT019FEC"), GETMV("MV_ZL00001",, .F.), .F.)

	Case cCampo == "ZM1_DTINI"
		lRet := IIF(ISINCALLSTACK("U_LT019ABE"), GETMV("MV_ZL00001",, .F.), IIF(ISINCALLSTACK("U_LT019ALT"), .T., .F.))

	Case cCampo == "ZM1_DTFIN"
		lRet := IIF(ISINCALLSTACK("U_LT019FEC"), GETMV("MV_ZL00001",, .F.), IIF(ISINCALLSTACK("U_LT019ALT"), .T., .F.))

	Case cCampo == "ZM1_HRINI"
		lRet := IIF(ISINCALLSTACK("U_LT019ABE"), GETMV("MV_ZL00001",, .F.), IIF(ISINCALLSTACK("U_LT019ALT"), .T., .F.))

	Case cCampo == "ZM1_HRFIN"
		lRet := IIF(ISINCALLSTACK("U_LT019FEC"), GETMV("MV_ZL00001",, .F.), IIF(ISINCALLSTACK("U_LT019ALT"), .T., .F.))


	EndCase

Return lRet





/*

ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
ฑฑษออออออออออัออออออออออหอออออออัออออออออออออออออออออหออออออัอออออออออออออปฑฑ
ฑฑบPrograma  ณLT019KGM    บAutor  ณMarcelo Joner    บ Data ณ  12/02/2020  บฑฑ
ฑฑฬออออออออออุออออออออออสอออออออฯออออออออออออออออออออสออออออฯอออออออออออออนฑฑ
ฑฑบDesc.     ณFun็ใo responsavel por realizar as valida็๕es/procedimentos บฑฑ
ฑฑบ          ณreferentes เ informa็ใo de peso via senha.                  บฑฑ
ฑฑฬออออออออออุออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออนฑฑ
ฑฑบUso       ณ Laticinio                                                  บฑฑ
ฑฑศออออออออออฯออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออผฑฑ
ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿
*/
User Function LT019KGM(cPesagem)

	Local nOpcao 		:=  2
	Local aSize			:= {}
	Local aObjects		:= {}
	Local aInfo			:= {}
	Local aPosObj		:= {}

	Private oGet2
	Private oGet3
	Private lEdit		:= .F.
	Private nPeso		:= 0
	Private cPsw		:= SPACE(20)
	Private cMotivo		:= SPACE(TAMSX3("ZM2_MOTIVO")[1])

	Default cPesagem	:= IIF(ISINCALLSTACK("U_LT019ABE"), "E", IIF(ISINCALLSTACK("U_LT019FEC"), "S", IIF(ISINCALLSTACK("U_LT019DES"), "E", "")))

//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
//ณGarante que as regras sejam executadas apenas se esta posicionado na aba Pesagem\Classifica็ใoณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	If oFld:nOption == 3

		//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		//ณAborta execu็ใo da fun็ใo caso exista diverg๊ncia nos parโmetros em rela็ใo เ funcionalidade que estแ em execu็ใoณ
		//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		If (ISINCALLSTACK("U_LT019ABE") .AND. cPesagem != "E") .OR. (ISINCALLSTACK("U_LT019FEC") .AND. cPesagem != "S")
			Return
		EndIf

		//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		//ณCaso seja executado เ partir da funcionalidade DESCARTE, valida que tenha anแlise qualidade selecionadaณ
		//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		If ISINCALLSTACK("U_LT019DES")
			lAchou := .F.
			dbSelectArea(cAliasQLD)
			nRecQLD := (cAliasQLD)->(RECNO())
			(cAliasQLD)->(dbGoTop())
			While (cAliasQLD)->(!EOF())
				If !EMPTY((cAliasQLD)->OK)
					lAchou := .T.
					exit
				EndIf
				(cAliasQLD)->(dbSkip())
			End
			(cAliasQLD)->(dbGoTo(nRecQLD))

			If !lAchou
				U_GLALL001("Aten็ใo", "Nใo foi selecionado เ anแlise de qualidade referente hแ realiza็ใo do descarte.", "Para utilizar estแ funcionalidade, ้ necessแrio selecionar เ anแlise de qualidade vinculada เ ocorr๊ncia do descarte.")
				Return
			EndIf
		EndIf

		//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		//ณRemove defini็๕es de teclas de atalhoณ
		//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		SetKey(VK_F5, Nil)
		SetKey(VK_F8, Nil)

		//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		//ณ Montagem dos parโmetros para cria็ใo da tela de exibi็ใoณ
		//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		aSize := MsAdvSize()
		AAdd(aObjects, {100, 100, .T., .F.})
		aInfo := {aSize[1], aSize[2], aSize[3], aSize[4], 2, 2}
		aPosObj := MsObjSize(aInfo, aObjects, .T.)

		//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		//ณInicia montagem do dialog de requisi็ใo da senhaณ
		//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		oDlgPesMan := MSDialog():New( 000,000,136,500,"Pesagem Manual",,,.F.,,,,,,.T.,,,.T. )
		oDlgPesMan:bInit := {|| ENCHOICEBAR(oDlgPesMan,{|| IIF(LT019PSW(.T.), (nOpcao := 1, oDlgPesMan:End()),) },{|| (nOpcao :=  2, oDlgPesMan:End())},.F.,{})}
		oSay1 := TSay():New(aPosObj[1,1]+001,008,{|| "Senha"},oDlgPesMan,,,.F.,.F.,.F.,.T.,CLR_HBLUE,CLR_WHITE,032,008)
		oSay2 := TSay():New(aPosObj[1,1]+012,008,{|| "Peso"},oDlgPesMan,,,.F.,.F.,.F.,.T.,CLR_HBLUE,CLR_WHITE,032,008)
		oSay3 := TSay():New(aPosObj[1,1]+024,008,{|| "Motivo"},oDlgPesMan,,,.F.,.F.,.F.,.T.,CLR_HBLUE,CLR_WHITE,032,008)
		oGet1 := TGet():New(aPosObj[1,1]+000,036, {|u| If(PCount()>0,@cPsw := u ,@cPsw)},oDlgPesMan,060,008,'', {|| LT019PSW()},CLR_BLACK,CLR_WHITE,,,,.T.,"",,,.F.,.F.,,.F.,.T.,"","@cPsw",,)
		oGet2 := TGet():New(aPosObj[1,1]+011,036, {|u| If(PCount()>0,@nPeso := u ,@nPeso)},oDlgPesMan,070,008,PESQPICT("ZM1", "ZM1_KGINI"), {|| LT019VKGMN(nPeso)},CLR_BLACK,CLR_WHITE,,,,.T.,"",,,.F.,.F.,,.F.,lEdit,"","@nPeso",,,,.T.)
		oGet3 := TGet():New(aPosObj[1,1]+023,036, {|u| If(PCount()>0,@cMotivo := u ,@cMotivo)},oDlgPesMan,190,008,'@!', {|| .T.},CLR_BLACK,CLR_WHITE,,,,.T.,"",,,.F.,.F.,,.F.,lEdit,"","@cMotivo",,)
		oDlgPesMan:Activate(,,,.T.)

		//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		//ณVerifica se o usuario confirmou a pesagem manualณ
		//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		If nOpcao == 1

			//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
			//ณPega o numero do pr๓ximo item na tabela ZM2ณ
			//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
			dbSelectArea("ZM2")
			ZM2->(dbSetOrder(1))
			ZM2->(dbGoTop())
			If ZM2->(dbSeek(xFilial("ZM2") + M->ZM1_NUM))
				nItem := 1
				While (ZM2->(!EOF()) .AND. ZM2->ZM2_NUM == M->ZM1_NUM)
					nItem++
					ZM2->(dbSkip())
				End
				nItem++
			Else
				nItem := 1
			EndIf

			//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
			//ณVerifica qual a rotina que esta sendo executadaณ
			//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
			Do Case
			Case ISINCALLSTACK("U_LT019ABE")
				cRotina :=  "1"

			Case ISINCALLSTACK("U_LT019FEC")
				cRotina :=  "2"

			Case ISINCALLSTACK("U_LT019ALT")
				cRotina :=  "3"

			Case ISINCALLSTACK("U_LT019DES")
				cRotina :=  "4"
			End Case

			//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
			//ณInsere registro de log na tabela ZM2ณ
			//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
			RECLOCK("ZM2", .T.)
			ZM2->ZM2_FILIAL	:= xFilial("ZM2")
			ZM2->ZM2_NUM	:= M->ZM1_NUM
			ZM2->ZM2_ITEM	:= STRZERO(nItem, TAMSX3("ZM2_ITEM")[1])
			ZM2->ZM2_CODUSR	:= __cUserId
			ZM2->ZM2_NOMUSR	:= cUserName
			ZM2->ZM2_DTANT	:= IIF(cRotina $ "1\4", M->ZM1_DTINI, M->ZM1_DTFIN)
			ZM2->ZM2_HRANT	:= IIF(cRotina $ "1\4", M->ZM1_HRINI, M->ZM1_HRFIN)
			ZM2->ZM2_VLRANT	:= IIF(cRotina $ "1\4", M->ZM1_KGINI, M->ZM1_KGFIN)
			ZM2->ZM2_DATA	:= dDataBase
			ZM2->ZM2_HORA	:= SUBSTR(GetRmtTime(), 1, 5)
			ZM2->ZM2_VALOR	:= nPeso
			ZM2->ZM2_FUNCAO	:= cRotina
			ZM2->ZM2_MOTIVO	:= cMotivo
			ZM2->(MSUNLOCK())

			//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
			//ณVerifica se trata-se da primeira pesagem da cargaณ
			//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
			If cPesagem == "E"

				//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				//ณSendo execu็ใo atrav้s da funcionalidade de DESCARTE, atualiza o registro da anแlise selecionadaณ
				//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				If ISINCALLSTACK("U_LT019DES")
					dbSelectArea(cAliasQLD)
					nRecQLD := (cAliasQLD)->(RECNO())
					(cAliasQLD)->(dbGoTop())
					While (cAliasQLD)->(!EOF())
						If !EMPTY((cAliasQLD)->OK)
							RECLOCK(cAliasQLD, .F.)
							(cAliasQLD)->ZM3_KGANT	:= IIF((cAliasQLD)->ZM3_KGANT == 0, M->ZM1_KGINI, (cAliasQLD)->ZM3_KGANT)
							(cAliasQLD)->ZM3_KGPOS	:= nPeso
							(cAliasQLD)->ZM3_DTDES	:= dDataBase
							(cAliasQLD)->ZM3_HRDES	:= SUBSTR(TIME(), 1, 5)
							(cAliasQLD)->ZM3_USRDES	:= __cUserId
							(cAliasQLD)->ZM3_NOMDES	:= cUserName
							(cAliasQLD)->(MSUNLOCK())
						EndIf
						(cAliasQLD)->(dbSkip())
					End
					(cAliasQLD)->(dbGoTo(nRecQLD))
				EndIf

				M->ZM1_KGINI := nPeso
				M->ZM1_DTINI := dDataBase
				M->ZM1_HRINI := SUBSTR(GetRmtTime(), 1, 5)
				M->ZM1_KGBRT := nPeso
			Else
				//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				//ณRefere-se a segunda pesagem da cargaณ
				//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				M->ZM1_KGFIN := nPeso
				M->ZM1_DTFIN := dDataBase
				M->ZM1_HRFIN := SUBSTR(GetRmtTime(), 1, 5)
				//M->ZM1_KGBRT := ROUND(IIF(M->ZM1_TIPO == "1", (M->ZM1_KGINI - nPeso), (nPeso - M->ZM1_KGINI)), TAMSX3("ZM1_KGBRT")[2])
			EndIf
		EndIf

		//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		//ณExecuta fun็ใo de avalia็ใo das informa็๕es de peso da carga e composi็ใo do TIPO da pesagemณ
		//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

		U_LTMOV9TP()


		//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		//ณRestaura teclas de atalho da interface principal da rotinaณ
		//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		SetKey(VK_F5, {|| MOV001CBALANCA(1)})
		SetKey(VK_F8, {|| U_LT019KGM()})
	EndIf

Return





/*

ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
ฑฑษออออออออออัออออออออออหอออออออัออออออออออออออออออออหออออออัอออออออออออออปฑฑ
ฑฑบPrograma  ณLT019PSW    บAutor  ณMarcelo Joner บ     Data ณ  12/02/2020 บฑฑ
ฑฑฬออออออออออุออออออออออสอออออออฯออออออออออออออออออออสออออออฯอออออออออออออนฑฑ
ฑฑบDesc.     ณFun็ใo responsavel por verificar a senha de libera็ใo de    บฑฑ
ฑฑบ          ณpesagem manual na rotina de pesagens.                       บฑฑ
ฑฑฬออออออออออุออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออนฑฑ
ฑฑบUso       ณ Laticinio                                                  บฑฑ
ฑฑศออออออออออฯออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออผฑฑ
ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿
*/
Static Function LT019PSW(lConfirm)

	Local lRet 			:= .T.

	Default lConfirm	:= .F.

//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
//ณBusca senha do parametro, pois trata-se de uma filialณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	If !UPPER(ALLTRIM(cPsw)) == UPPER(ALLTRIM(GETMV("MV_ZL00002", .T., "ฐ")))
		lRet := .F.
		lEdit := .F.
		nPeso := 0
		U_GLALL001("Aten็ใo", "Senha invแlida.", "A senha informada nใo corresponde เ senha de libera็ใo definida para esta filial.")
	Else
		lEdit := .T.
	EndIf

//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
//ณAo confirmar เ tela de informa็๕es de pesagem manual, aplica demais valida็๕esณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	If lRet .AND. lConfirm
		If nPeso <= 0
			lRet := .F.
			U_GLALL001("Aten็ใo", "O peso informado ้ invแlido.", "O peso informado deve ser superior เ zero.")
		Else
			//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
			//ณValida composi็ใo do motivo referente เ ocorr๊ncia da pesagem manualณ
			//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
			If LEN(ALLTRIM(cMotivo)) < 15
				lRet := .F.
				U_GLALL001("Aten็ใo", "Motivo de ocorr๊ncia da pesagem manual.", "Favor informar o motivo referente เ realiza็ใo da pesagem manual.")
			EndIf
		EndIf
	EndIf

//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
//ณAtualiza TGet utilizado para informa็ใo manual do pesoณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	oGet2:CtrlRefresh()

Return lRet





/*

ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
ฑฑษออออออออออัออออออออออหอออออออัออออออออออออออออออออหออออออัอออออออออออออปฑฑ
ฑฑบPrograma  ณLT019VKGMN  บAutor  ณMarcelo Joner     บ Data ณ  12/02/2020 บฑฑ
ฑฑฬออออออออออุออออออออออสอออออออฯออออออออออออออออออออสออออออฯอออออออออออออนฑฑ
ฑฑบDesc.     ณFun็ใo responsavel por validar o peso informado pelo usuแrioบฑฑ
ฑฑบ          ณao utilizar o recurso via senha.                            บฑฑ
ฑฑฬออออออออออุออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออนฑฑ
ฑฑบUso       ณGestใo de Cereais                                           บฑฑ
ฑฑศออออออออออฯออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออผฑฑ
ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿
*/
Static Function LT019VKGMN(nPeso)

	Local lRet		:= .T.

//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
//ณExecuta regras caso o valor de pesagem seja vแlidoณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	If !POSITIVO(nPeso)
		lRet := .F.
	EndIf

Return lRet





/*

ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
ฑฑษออออออออออัออออออออออหอออออออัออออออออออออออออออออหออออออัอออออออออออออปฑฑ
ฑฑบPrograma  ณLT019INTBL     บAutor  ณMarcelo Joner บ  Data ณ  12/02/2020 บฑฑ
ฑฑฬออออออออออุออออออออออสอออออออฯออออออออออออออออออออสออออออฯอออออออออออออนฑฑ
ฑฑบDesc.     ณFun็ใo responsavel pela comunica็ใo com เ balan็a e obten็ใoบฑฑ
ฑฑบ          ณda informa็ใo de peso do veํculo.                           บฑฑ
ฑฑฬออออออออออุออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออนฑฑ
ฑฑบUso       ณ Laticinio                                                  บฑฑ
ฑฑศออออออออออฯออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออผฑฑ
ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿
*/
Static Function LT019INTBL(nBalanca)

	Local cPorta 		:= ""
	Local cDados 		:= ""
	Local cBalanca		:= ""
	Local cPesoOld		:= ""
	Local nResp			:= 0
	Local nLeitDef		:= 0
	Local nLeitExe		:= 0
	Local lConectou 	:= .F.
	Local lPeso			:= .F.

	Private nHdll		:= 0

	Default nBalanca	:= 1

//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
//ณExecuta demais regras, caso esteja com foco na sessใo de PESAGEM presente na telaณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	If oFld:nOption != 3
		Return
	EndIf

//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
//ณCaso seja executado เ partir da funcionalidade DESCARTE, valida que tenha anแlise qualidade selecionadaณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	If ISINCALLSTACK("U_LT019DES")
		lAchou := .F.
		dbSelectArea(cAliasQLD)
		nRecQLD := (cAliasQLD)->(RECNO())
		(cAliasQLD)->(dbGoTop())
		While (cAliasQLD)->(!EOF())
			If !EMPTY((cAliasQLD)->OK)
				lAchou := .T.
				exit
			EndIf
			(cAliasQLD)->(dbSkip())
		End
		(cAliasQLD)->(dbGoTo(nRecQLD))

		If !lAchou
			U_GLALL001("Aten็ใo", "Nใo foi selecionado เ anแlise de qualidade referente hแ realiza็ใo do descarte.", "Para utilizar estแ funcionalidade, ้ necessแrio selecionar เ anแlise de qualidade vinculada เ ocorr๊ncia do descarte.")
			Return
		EndIf
	EndIf

//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
//ณRealiza chamada da fun็ใo responsแvel por verificar a balan็a utilizadaณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	cBalanca := LT019LDBAL(nBalanca)

//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
//ณHavendo balan็a configurada, executa regras de integra็ใoณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	If cBalanca != "F00001"
		dbSelectArea("ZM0")
		ZM0->(dbSetOrder(1))
		ZM0->(dbGoTop())
		If ZM0->(dbSeek(xFilial("ZM0") + cBalanca))
			nLeitDef := ZM0->ZM0_NUMLEI

			//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
			//ณExecuta procedimentos de conexใo SERIAL com a balan็aณ
			//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
			If ZM0->ZM0_TPCONE == "1"

				//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				//ณVerifica a porta de comunica็ใo da balan็aณ
				//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				cPorta := "COM" + ALLTRIM(ZM0->ZM0_PRTCOM)
				nMaxTen:= IIF(ZM0->ZM0_NUMEXE > 0, ZM0->ZM0_NUMEXE, 50)

				//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				//ณRealiza a conexใo com a balan็aณ
				//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				If MsOpenPort(nHdll,cPorta + ":" + ALLTRIM(ZM0->ZM0_VELOCI) + "," + ZM0->ZM0_PARARI + "," + ZM0->ZM0_BITDAD + "," +ZM0->ZM0_BITPAR)
					cDados := U_GLGETANSWER(nHdll, cDados, 1)
					cDados := ALLTRIM(cDados)
					U_GLCLOSEPORT(nHdll)

					//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
					//ณExecuta leituras do peso enquanto o mesmo no for estavelณ
					//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
					nCount := 0
					While !lPeso

						//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
						//ณCaso exista caractere de quebra, adequa string de retorno antes das demais anแlisesณ
						//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
					/*
					If ZM0->ZM0_USAQBR == "1"
						cDados := SUBSTR(cDados, At(SUBSTR(ZM0->ZM0_CHRQBR, 1, ZM0->ZM0_TAMQBR), cDados) + 1, 30)
					EndIf
					*/

						//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
						//ณCaso o peso obtido esteja estavel, retorna o mesmoณ
						//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
						If SUBSTR(cDados, ZM0->ZM0_ESTINI, (ZM0->ZM0_ESTFIM - ZM0->ZM0_ESTINI)) == ALLTRIM(ZM0->ZM0_ESTDET)

							//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
							//ณExecuta regras caso เ balan็a possua controle de leitura de peso consecutivas iguaisณ
							//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
							If nLeitDef > 0
								If cPesoOld == SUBSTR(cDados, ZM0->ZM0_KGINI, (ZM0->ZM0_KGFIM - ZM0->ZM0_KGINI) + 1)
									nLeitExe++
								Else
									nLeitExe := 0
									cPesoOld := SUBSTR(cDados, ZM0->ZM0_KGINI, (ZM0->ZM0_KGFIM - ZM0->ZM0_KGINI) + 1)
								EndIf

								//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
								//ณCaso o n๚mero de leituras de peso equivalente tenha sido atingido, acata o peso em questใoณ
								//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
								If nLeitExe >= nLeitDef
									cDados		:= SUBSTR(cDados, ZM0->ZM0_KGINI, (ZM0->ZM0_KGFIM - ZM0->ZM0_KGINI) + 1)
									lPeso		:= .T.
									lConectou	:= .T.
									exit
								EndIf
							Else

								//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
								//ณSe nใo valida leituras equivalentes, jแ acata o peso obtidoณ
								//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
								cDados		:= SUBSTR(cDados, ZM0->ZM0_KGINI, (ZM0->ZM0_KGFIM - ZM0->ZM0_KGINI) + 1)
								lPeso		:= .T.
								lConectou	:= .T.
								exit
							EndIf
						EndIf

						//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
						//ณCaso o peso nใo seja vแlido, efetua nova conexใoณ
						//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
						If !lPeso

							//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
							//ณEfetua nova comunio/leitura do peso na porta COMณ
							//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
							MsOpenPort(nHdll,cPorta + ":" + ALLTRIM(ZM0->ZM0_VELOCI) + "," + ZM0->ZM0_PARARI + "," + ZM0->ZM0_BITDAD + "," +ZM0->ZM0_BITPAR)
							cDados := U_GLGETANSWER(nHdll, cDados, 1)
							cDados := ALLTRIM(cDados)
							U_GLCLOSEPORT(nHdll)

							//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
							//ณVerifica numero mแximo de conex๕es para leitura do pesoณ
							//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
							nCount++
							If nCount > nMaxTen
								exit
							EndIf
						EndIf
					End
				EndIf

				//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				//ณValida se foi obtido conexao com alguma balanca, caso nao,ณ
				//ณapresenta mensagem alertando o usuario.                   ณ
				//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				If !lConectou
					U_GLALL001("Aten็ใo", "Nใo foi possํvel efetuar conexใo com เ balan็a " + cBalanca + " em nenhuma das portas: " + CHR(10) + CHR(10) + "COM1, COM2, COM3, COM4, COM5 e COM6.", "Favor verificar se เ balan็a estแ ligada e conectada de maneira correta ao terminal." + CHR(10) + CHR(10) + "Caso o problema persista, favor efetuar contato com o departamento responsแvel.")
					Return
				Else
					//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
					//ณRetorna o peso para o campo correspondente conforme a rotina realizadaณ
					//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
					If ISINCALLSTACK("U_LT019ABE") .OR. ISINCALLSTACK("U_LT019DES")

						//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
						//ณVerifica se trata-se de repesagem na ABERTURA da pesagemณ
						//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
						If M->ZM1_KGINI > 0 .AND. ISINCALLSTACK("U_LT019ABE")
							If AVISO("Aten็ใo", "Confirma เ repesagem do peso de entrada?", {"Sim", "Nใo"}, 2) == 1

								//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
								//ณGrava registro de log referente a repesagemณ
								//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
								dbSelectArea("ZM2")
								ZM2->(dbSetOrder(1))
								ZM2->(dbGoTop())
								If ZM2->(dbSeek(xFilial("ZM2") + M->ZM1_NUM))
									nItem := 1
									While (ZM2->(!EOF()) .AND. ZM2->ZM2_NUM == M->ZM1_NUM)
										nItem++
										ZM2->(dbSkip())
									End
									nItem++
								Else
									nItem := 1
								EndIf

								//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
								//ณInsere registro de log na tabela ZM2ณ
								//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
								RECLOCK("ZM2", .T.)
								ZM2->ZM2_FILIAL	:= xFilial("ZM2")
								ZM2->ZM2_NUM    := M->ZM1_NUM
								ZM2->ZM2_ITEM	:= STRZERO(nItem, TAMSX3("ZM2_ITEM")[1])
								ZM2->ZM2_CODUSR := __cUserId
								ZM2->ZM2_NOMUSR	:= cUserName
								ZM2->ZM2_DTANT	:= M->ZM1_DTINI
								ZM2->ZM2_HRANT	:= M->ZM1_HRINI
								ZM2->ZM2_VLRANT	:= M->ZM1_KGINI
								ZM2->ZM2_DATA	:= dDataBase
								ZM2->ZM2_HORA	:= SUBSTR(GetRmtTime(), 1, 5)
								ZM2->ZM2_VALOR	:= ROUND(ABS(VAL(cDados)), 0)
								ZM2->ZM2_FUNCAO	:= "1"
								ZM2->ZM2_MOTIVO	:= "REPESAGEM VIA BALANวA"
								ZM2->(MSUNLOCK())
							Else
								Return
							EndIf
						EndIf

						//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
						//ณSendo execu็ใo atrav้s da funcionalidade de DESCARTE, atualiza o registro da anแlise selecionadaณ
						//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
						If ISINCALLSTACK("U_LT019DES")
							dbSelectArea(cAliasQLD)
							nRecQLD := (cAliasQLD)->(RECNO())
							(cAliasQLD)->(dbGoTop())
							While (cAliasQLD)->(!EOF())
								If !EMPTY((cAliasQLD)->OK)
									RECLOCK(cAliasQLD, .F.)
									(cAliasQLD)->ZM3_KGANT	:= IIF((cAliasQLD)->ZM3_KGANT == 0, M->ZM1_KGINI, (cAliasQLD)->ZM3_KGANT)
									(cAliasQLD)->ZM3_KGPOS	:= ROUND(ABS(VAL(cDados)), 0)
									(cAliasQLD)->ZM3_DTDES	:= dDataBase
									(cAliasQLD)->ZM3_HRDES	:= SUBSTR(TIME(), 1, 5)
									(cAliasQLD)->ZM3_USRDES	:= __cUserId
									(cAliasQLD)->ZM3_NOMDES	:= cUserName
									(cAliasQLD)->(MSUNLOCK())
								EndIf
								(cAliasQLD)->(dbSkip())
							End
							(cAliasQLD)->(dbGoTo(nRecQLD))

							//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
							//ณGrava registro de log referente a repesagemณ
							//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
							dbSelectArea("ZM2")
							ZM2->(dbSetOrder(1))
							ZM2->(dbGoTop())
							If ZM2->(dbSeek(xFilial("ZM2") + M->ZM1_NUM))
								nItem := 1
								While (ZM2->(!EOF()) .AND. ZM2->ZM2_NUM == M->ZM1_NUM)
									nItem++
									ZM2->(dbSkip())
								End
								nItem++
							Else
								nItem := 1
							EndIf

							//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
							//ณInsere registro de log na tabela ZM2ณ
							//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
							RECLOCK("ZM2", .T.)
							ZM2->ZM2_FILIAL	:= xFilial("ZM2")
							ZM2->ZM2_NUM    := M->ZM1_NUM
							ZM2->ZM2_ITEM	:= STRZERO(nItem, TAMSX3("ZM2_ITEM")[1])
							ZM2->ZM2_CODUSR := __cUserId
							ZM2->ZM2_NOMUSR	:= cUserName
							ZM2->ZM2_DTANT	:= M->ZM1_DTINI
							ZM2->ZM2_HRANT	:= M->ZM1_HRINI
							ZM2->ZM2_VLRANT	:= M->ZM1_KGINI
							ZM2->ZM2_DATA	:= dDataBase
							ZM2->ZM2_HORA	:= SUBSTR(GetRmtTime(), 1, 5)
							ZM2->ZM2_VALOR	:= ROUND(ABS(VAL(cDados)), 0)
							ZM2->ZM2_FUNCAO	:= "4"
							ZM2->ZM2_MOTIVO	:= "REPESAGEM VIA BALANวA"
							ZM2->(MSUNLOCK())
						EndIf

						//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
						//ณAtualiza as informa็๕es de pesagemณ
						//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
						M->ZM1_KGINI := ROUND(ABS(VAL(cDados)), 0)
						M->ZM1_DTINI := dDataBase
						M->ZM1_HRINI := SUBSTR(GetRmtTime(), 1, 5)
						M->ZM1_KGBRT := M->ZM1_KGINI

					Else

						//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
						//ณFuncionalidade de fechamento da pesagemณ
						//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
						If ISINCALLSTACK("U_LT019FEC")

							//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
							//ณVerifica se trata-se de repesagemณ
							//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
							If M->ZM1_KGFIN  > 0
								If AVISO("Aten็ใo", "Confirma เ repesagem do peso saํda?", {"Sim", "Nใo"}, 2) == 1

									//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
									//ณGrava registro de log referente a repesagemณ
									//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
									dbSelectArea("ZM2")
									ZM2->(dbSetOrder(1))
									ZM2->(dbGoTop())
									If ZM2->(dbSeek(xFilial("ZM2") + M->ZM1_NUM))
										nItem := 1
										While (ZM2->(!EOF()) .AND. ZM2->ZM2_NUM == M->ZM1_NUM)
											nItem++
											ZM2->(dbSkip())
										End
										nItem++
									Else
										nItem := 1
									EndIf

									//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
									//ณInsere registro de log na tabela ZM2ณ
									//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
									RECLOCK("ZM2", .T.)
									ZM2->ZM2_FILIAL	:= xFilial("ZM2")
									ZM2->ZM2_NUM    := M->ZM1_NUM
									ZM2->ZM2_ITEM	:= STRZERO(nItem, TAMSX3("ZM2_ITEM")[1])
									ZM2->ZM2_CODUSR := __cUserId
									ZM2->ZM2_NOMUSR	:= cUserName
									ZM2->ZM2_DTANT	:= M->ZM1_DTFIN
									ZM2->ZM2_HRANT	:= M->ZM1_HRFIN
									ZM2->ZM2_VLRANT	:= M->ZM1_KGFIN
									ZM2->ZM2_DATA	:= dDataBase
									ZM2->ZM2_HORA	:= SUBSTR(GetRmtTime(), 1, 5)
									ZM2->ZM2_VALOR	:= ROUND(ABS(VAL(cDados)), 0)
									ZM2->ZM2_FUNCAO	:= "2"
									ZM2->ZM2_MOTIVO	:= "REPESAGEM VIA BALANวA"
									ZM2->(MSUNLOCK())
								Else
									Return
								EndIf
							EndIf

							//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
							//ณAtualiza as informa็๕es de pesagemณ
							//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
							M->ZM1_KGFIN := ROUND(ABS(VAL(cDados)), 0)
							M->ZM1_DTFIN := dDataBase
							M->ZM1_HRFIN := SUBSTR(GetRmtTime(), 1, 5)
							M->ZM1_KGBRT := ROUND(IIF(M->ZM1_TIPO == "1", (M->ZM1_KGINI - M->ZM1_KGFIN), (M->ZM1_KGFIN - M->ZM1_KGINI)), TAMSX3("ZM1_KGBRT")[2])
						EndIf
					EndIf
				EndIf

			Else

				//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				//ณExecuta procedimentos de conexใo TCP/IP com a balan็aณ
				//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				nMaxTen  := IIF(ZM0->ZM0_NUMEXE > 0, ZM0->ZM0_NUMEXE, 50)
				oBalanca := tSocketClient():New()

				nResp := oBalanca:Connect(VAL(ALLTRIM(ZM0->ZM0_PRTIP)), ALLTRIM(ZM0->ZM0_IP), 100)

				//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				//ณAguarda ap๓s a conexใo visando estabelecer comunica็ใo com a balan็aณ
				//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				sleep(2000)

				If nResp == 0 .AND. oBalanca:IsConnected()

					oBalanca:Send(ALLTRIM(ZM0->ZM0_ENVIP))

					//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
					//ณExecuta leituras do peso enquanto o mesmo no for estavelณ
					//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
					nCount := 0
					While !lPeso

						//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
						//ณVerifica se recebeu retorno de informa็๕es da balan็aณ
						//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
						If oBalanca:Receive(cDados, 1000) > 0
							cDados := ALLTRIM(cDados)

							//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
							//ณPonto de entrada para tratamento nos dados obtidos da balan็aณ
							//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
							If ExistBlock("MOV01BAL")
								cDados := ExecBlock("MOV01BAL", .F., .F., {cDados})
							EndIf

							//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
							//ณCaso exista caractere de quebra, adequa string de retorno antes das demais anแlisesณ
							//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
						/*
						If ZM0->ZM0_USAQBR == "1"
							cDados := SUBSTR(cDados, At(SUBSTR(ZM0->ZM0_CHRQBR, 1, ZM0->ZM0_TAMQBR), cDados) + 1, 30)
						EndIf
						*/

							//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
							//ณCaso o peso obtido esteja estavel, retorna o mesmoณ
							//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
							If SUBSTR(cDados, ZM0->ZM0_ESTINI, ZM0->ZM0_ESTFIM) == ALLTRIM(ZM0->ZM0_ESTDET)

								//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
								//ณExecuta regras caso เ balan็a possua controle de leitura de peso consecutivas iguaisณ
								//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
								If nLeitDef > 0
									If cPesoOld == SUBSTR(cDados, ZM0->ZM0_KGINI, (ZM0->ZM0_KGFIM - ZM0->ZM0_KGINI) + 1)
										nLeitExe++
									Else
										nLeitExe := 0
										cPesoOld := SUBSTR(cDados, ZM0->ZM0_KGINI, (ZM0->ZM0_KGFIM - ZM0->ZM0_KGINI) + 1)
									EndIf

									//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
									//ณCaso o n๚mero de leituras de peso equivalente tenha sido atingido, acata o peso em questใoณ
									//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
									If nLeitExe >= nLeitDef
										cDados		:= SUBSTR(cDados, ZM0->ZM0_KGINI, (ZM0->ZM0_KGFIM - ZM0->ZM0_KGINI) + 1)
										lPeso		:= .T.
										lConectou	:= .T.
										exit
									EndIf
								Else

									//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
									//ณSe nใo valida leituras equivalentes, jแ acata o peso obtidoณ
									//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
									cDados		:= SUBSTR(cDados, ZM0->ZM0_KGINI, (ZM0->ZM0_KGFIM - ZM0->ZM0_KGINI) + 1)
									lPeso		:= .T.
									lConectou	:= .T.
									exit
								EndIf
							EndIf
						EndIf

						//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
						//ณCaso o peso nใo seja vแlido, atualiza contador de tentavias de leituraณ
						//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
						If !lPeso

							//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
							//ณVerifica numero mแximo de conex๕es para leitura do pesoณ
							//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
							nCount++
							If nCount > nMaxTen
								oBalanca:CloseConnection()
								exit
							EndIf
						EndIf
					End

					oBalanca:CloseConnection()

					//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
					//ณValida se foi obtido conexao com alguma balanca, caso nao,ณ
					//ณapresenta mensagem alertando o usuario.                   ณ
					//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
					If !lConectou
						U_GLALL001("Aten็ใo", "Nใo foi possํvel efetuar conexใo com เ balan็a " + cBalanca + " no endere็o IP: " + ALLTRIM(ZM0->ZM0_IP) + ".", "Favor verificar se เ balan็a estแ ligada e conectada em rede no IP configurado no cadastro." + CHR(10) + CHR(10) + "Caso o problema persista, favor efetuar contato com o departamento responsแvel.")
						Return
					Else
						//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
						//ณRetorna o peso para o campo correspondente conforme a rotina realizadaณ
						//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
						If ISINCALLSTACK("U_LT019ABE")

							//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
							//ณVerifica se trata-se de repesagemณ
							//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
							If M->ZM1_KGINI > 0
								If AVISO("Aten็ใo", "Confirma เ repesagem do peso de entrada?", {"Sim", "Nใo"}, 2) == 1

									//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
									//ณGrava registro de log referente a repesagemณ
									//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
									dbSelectArea("ZM2")
									ZM2->(dbSetOrder(1))
									ZM2->(dbGoTop())
									If ZM2->(dbSeek(xFilial("ZM2") + M->ZM1_NUM))
										nItem := 1
										While (ZM2->(!EOF()) .AND. ZM2->ZM2_NUM == M->ZM1_NUM)
											nItem++
											ZM2->(dbSkip())
										End
										nItem++
									Else
										nItem := 1
									EndIf

									//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
									//ณInsere registro de log na tabela ZM2ณ
									//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
									RECLOCK("ZM2", .T.)
									ZM2->ZM2_FILIAL	:= xFilial("ZM2")
									ZM2->ZM2_NUM    := M->ZM1_NUM
									ZM2->ZM2_ITEM	:= STRZERO(nItem, TAMSX3("ZM2_ITEM")[1])
									ZM2->ZM2_CODUSR := __cUserId
									ZM2->ZM2_NOMUSR	:= cUserName
									ZM2->ZM2_DTANT	:= M->ZM1_DTINI
									ZM2->ZM2_HRANT	:= M->ZM1_HRINI
									ZM2->ZM2_VLRANT	:= M->ZM1_KGINI
									ZM2->ZM2_DATA	:= dDataBase
									ZM2->ZM2_HORA	:= SUBSTR(GetRmtTime(), 1, 5)
									ZM2->ZM2_VALOR	:= ROUND(ABS(VAL(cDados)), 0)
									ZM2->ZM2_FUNCAO	:= "1"
									ZM2->ZM2_MOTIVO	:= "REPESAGEM VIA BALANวA"
									ZM2->(MSUNLOCK())
								Else
									Return
								EndIf
							EndIf

							//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
							//ณAtualiza as informa็๕es de pesagemณ
							//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
							M->ZM1_KGINI := ROUND(ABS(VAL(cDados)), 0)
							M->ZM1_DTINI := dDataBase
							M->ZM1_HRINI := SUBSTR(GetRmtTime(), 1, 5)
							M->ZM1_KGBRT := M->ZM1_KGINI
						Else
							//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
							//ณVerifica se trata-se de repesagemณ
							//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
							If M->ZM1_KGFIN > 0
								If AVISO("Aten็ใo", "Confirma เ repesagem do peso saํda?", {"Sim", "Nใo"}, 2) == 1

									//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
									//ณGrava registro de log referente a repesagemณ
									//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
									dbSelectArea("ZM2")
									ZM2->(dbSetOrder(1))
									ZM2->(dbGoTop())
									If ZM2->(dbSeek(xFilial("ZM2") + M->ZM1_NUM))
										nItem := 1
										While (ZM2->(!EOF()) .AND. ZM2->ZM2_NUM == M->ZM1_NUM)
											nItem++
											ZM2->(dbSkip())
										End
										nItem++
									Else
										nItem := 1
									EndIf

									//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
									//ณInsere registro de log na tabela ZM2ณ
									//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
									RECLOCK("ZM2", .T.)
									ZM2->ZM2_FILIAL	:= xFilial("ZM2")
									ZM2->ZM2_NUM  	:= M->ZM1_NUM
									ZM2->ZM2_ITEM	:= STRZERO(nItem, TAMSX3("ZM2_ITEM")[1])
									ZM2->ZM2_CODUSR	:= __cUserId
									ZM2->ZM2_NOMUSR	:= cUserName
									ZM2->ZM2_DTANT	:= M->ZM1_DTFIN
									ZM2->ZM2_HRANT	:= M->ZM1_HRFIN
									ZM2->ZM2_VLRANT	:= M->ZM1_KGFIN
									ZM2->ZM2_DATA	:= dDataBase
									ZM2->ZM2_HORA	:= SUBSTR(GetRmtTime(), 1, 5)
									ZM2->ZM2_VALOR	:= ROUND(ABS(VAL(cDados)), 0)
									ZM2->ZM2_FUNCAO	:= "2"
									ZM2->ZM2_MOTIVO	:= "REPESAGEM VIA BALANวA"
									ZM2->(MSUNLOCK())
								Else
									Return
								EndIf
							EndIf

							//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
							//ณAtualiza as informa็๕es de pesagemณ
							//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
							M->ZM1_KGFIN := ROUND(ABS(VAL(cDados)), 0)
							M->ZM1_DTFIN := dDataBase
							M->ZM1_HRFIN := SUBSTR(GetRmtTime(), 1, 5)
							M->ZM1_KGBRT := ROUND(IIF(M->ZM1_TIPO == "1", (M->ZM1_KGINI - M->ZM1_KGFIN), (M->ZM1_KGFIN - M->ZM1_KGINI)), TAMSX3("ZM1_KGBRT")[2])
						EndIf
					EndIf
				Else
					//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
					//ณAlerta o usuแrio caso nใo conseguiu conexใo com เ balan็aณ
					//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
					U_GLALL001("Aten็ใo", "Nใo foi possํvel efetuar conexใo com เ balan็a " + cBalanca + " no endere็o IP: " + ALLTRIM(ZM0->ZM0_IP) + ".", "Favor verificar se เ balan็a estแ ligada e conectada em rede no IP configurado no cadastro." + CHR(10) + CHR(10) + "Caso o problema persista, favor efetuar contato com o departamento responsแvel.")
					Return
				EndIf
			EndIf
		Else
			//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
			//ณAlerta o usuแrio caso nใo conseguiu localizar เ balan็a vinculada ao arquivoณ
			//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
			U_GLALL001("Aten็ใo", "A balan็a " + cBalanca + " informada no arquivo de configura็ใo nใo foi localizada.", "Favor realizar เ exclusใo do arquivo de configura็ใo e ap๓s isto, efetuar nova configura็ใo da balan็a desejada.")
			Return
		EndIf
	EndIf

//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
//ณExecuta fun็ใo de avalia็ใo das informa็๕es de peso da carga e composi็ใo do TIPO da pesagemณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	U_LTMOV9TP()

Return





/*

ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
ฑฑษออออออออออัออออออออออหอออออออัออออออออออออออออออออหออออออัอออออออออออออปฑฑ
ฑฑบPrograma  ณLT019LDBAL    บAutor  ณMarcelo Joner    บ Data ณ 12/02/2020 บฑฑ
ฑฑฬออออออออออุออออออออออสอออออออฯออออออออออออออออออออสออออออฯอออออออออออออนฑฑ
ฑฑบDesc.     ณFun็ใo responsavel por verificar se jแ existe uma balanca   บฑฑ
ฑฑบ          ณutilizada no terminal, caso nใo, realiza procedimentos de   บฑฑ
ฑฑบ          ณapresenta็ใo das balancas existentes para filial logada de  บฑฑ
ฑฑบ          ณmodo que o usuario escolha a balan็a que serแ utilizada.    บฑฑ
ฑฑฬออออออออออุออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออนฑฑ
ฑฑบUso       ณ Laticinio                                                  บฑฑ
ฑฑศออออออออออฯออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออผฑฑ
ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿
*/
Static Function LT019LDBAL(nBalanca)

	Local aSize			:= {}
	Local aObjects		:= {}
	Local aInfo			:= {}
	Local aPosObj		:= {}
	Local cBalanca		:= ""
	Local cQuery		:= ""
	Local cArqTrab		:= ""
	Local nOpc			:= 2
	Local nItem			:= 0
	Local lLoad			:= .F.
	Local lInverte		:= .F.
	Local lReadOnly		:= .F.
	Local lShare		:= .T.
	Local aVwZM0		:= {}
	Local aStruct		:= {}
	Local cMarca		:= GetMark()
	Local cPath			:= GetTempPath()
	Local cCadOld		:= cCadastro

	Private cEOL		:= "CHR(13) + CHR(10)"
	Private cArqTxt		:= cPath + "balanca" + ALLTRIM(STR(nBalanca)) + ".ini"
	Private nHdl		:= fOpen(cArqTxt)
	Private cAlias		:= GetNextAlias()

	cEOL := &cEOL

//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
//ณExecuta procedimentos de abertura do arquivo de configura็ใo da balan็a utilizadaณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	If nHdl == -1
		U_GLALL001("Aten็ใo", "Nใo existe balan็a configurada para utiliza็ใo neste terminal.", "Favor efetuar os procedimentos เ seguir para efetuar configura็ใo de uma balan็a.")
	Else
		lLoad := .T.
	EndIf

//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
//ณCaso tenha encontrado o arquivo de configura็ใo da balan็a,    ณ
//ณrealiza os procedimentos de leitura e valida็ใo da configura็ใoณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	If lLoad
		nTamFile := fSeek(nHdl, 0, 2)
		fSeek(nHdl,0,0)
		nTamLin  := LEN(cEOL) + TAMSX3("ZM0_COD")[1]
		cBalanca := SPACE(nTamLin)

		//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		//ณCarrega c๓digo da balan็a presente no arquivoณ
		//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		If fRead(nHdl, @cBalanca, nTamLin) > 0
			cBalanca := ALLTRIM(cBalanca)
		Else
			//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
			//ณCaso ocorreram erros na leitura do arquivo, alerta o usuarioณ
			//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
			U_GLALL001("Aten็ใo", "Ocorreram erros na leitura do arquivo de configura็ใo.", "Nใo foi possํvel ler o arquivo " + cArqTxt)
			cBalanca := ""
		EndIf
	Else
		//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		//ณInicia procedimentos para apresenta็ใo ao usuario de todas as balancasณ
		//ณdisponiveis para utiliza็ใo na filial e posteriormente gera o arquivo ณ
		//ณde configura็ใo no terminal conforme เ balan็a selecionada            ณ
		//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		AADD(aVwZM0, {"ZM0_COD"   	, "", U_LTALLXSX3("ZM0_COD")[1]   	, U_LTALLXSX3("ZM0_COD")[6]   	})
		AADD(aVwZM0, {"ZM0_DESC"  	, "", U_LTALLXSX3("ZM0_DESC")[1]  	, U_LTALLXSX3("ZM0_DESC")[6]  	})
		AADD(aVwZM0, {"ZM0_TIPOCX"	, "", U_LTALLXSX3("ZM0_TPCONE")[1]	, U_LTALLXSX3("ZM0_TPCONE")[6]	})
		AADD(aVwZM0, {"ZM0_IP"    	, "", U_LTALLXSX3("ZM0_IP")[1]    	, U_LTALLXSX3("ZM0_IP")[6]    	})
		AADD(aVwZM0, {"ZM0_PORTAC"	, "", U_LTALLXSX3("ZM0_PRTCOM")[1] 	, U_LTALLXSX3("ZM0_PRTCOM")[6] 	})

		//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		//ณMonta estrutura da tabela temporariaณ
		//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		AADD(aStruct, {"ZM0_COD"   	, U_LTALLXSX3("ZM0_COD")[3]   	, U_LTALLXSX3("ZM0_COD")[4]   	, U_LTALLXSX3("ZM0_COD")[5]   	})
		AADD(aStruct, {"ZM0_DESC"  	, U_LTALLXSX3("ZM0_DESC")[3]  	, U_LTALLXSX3("ZM0_DESC")[4]  	, U_LTALLXSX3("ZM0_DESC")[5]  	})
		AADD(aStruct, {"ZM0_TIPOCX"	, U_LTALLXSX3("ZM0_TPCONE")[3]	, 07							, U_LTALLXSX3("ZM0_TPCONE")[5]	})
		AADD(aStruct, {"ZM0_IP"    	, U_LTALLXSX3("ZM0_IP")[3]    	, U_LTALLXSX3("ZM0_IP")[4]    	, U_LTALLXSX3("ZM0_IP")[5]    	})
		AADD(aStruct, {"ZM0_PORTAC"	, U_LTALLXSX3("ZM0_PRTCOM")[3] 	, U_LTALLXSX3("ZM0_PRTCOM")[4] 	, U_LTALLXSX3("ZM0_PRTCOM")[5] 	})

		//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		//ณMonta query de busca das balan็as disponํveis para utiliza็ใo na filial/parceria em questใoณ
		//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		cQuery := "SELECT DISTINCT									" + CRLF
		cQuery += "	    ZM0_COD,									" + CRLF
		cQuery += "	    ZM0_DESC,									" + CRLF
		cQuery += "	    ZM0_TPCONE,									" + CRLF
		cQuery += "     '" + SPACE(07) + "' ZM0_TIPOCX,				" + CRLF
		cQuery += "	    ZM0_IP,										" + CRLF
		cQuery += "	    ZM0_PRTCOM,									" + CRLF
		cQuery += "     '" + SPACE(05) + "' ZM0_PORTAC				" + CRLF

		cQuery += "FROM " + RetSQLName("ZM0") + " ZM0     			" + CRLF

		cQuery += "WHERE ZM0.ZM0_FILIAL  = '" + xFilial("ZM0") + "'	" + CRLF
		cQuery += "  AND ZM0.D_E_L_E_T_ <> '*'			  			" + CRLF

		cQuery += "ORDER BY ZM0_COD									" + CRLF

		cArqTrab  := CriaTrab( aStruct, .T. )

		If Select(cAlias) > 0
			(cAlias)->(dbCloseArea())
		EndIf

		cQuery := ChangeQuery(cQuery)

		TCQUERY cQuery NEW ALIAS cAlias

		Copy TO &cArqTrab
		dBCloseArea()
		dBUseArea( .T.,, cArqTrab, cAlias, lShare, lReadOnly )
		(cAlias)->(dbGoTop())
		While (cAlias)->(!EOF())
			RECLOCK(cAlias, .F.)
			(cAlias)->ZM0_TIPOCX := IIF((cAlias)->ZM0_TPCONE == "1", "SERIAL", "TCP/IP")
			(cAlias)->ZM0_PORTAC := "COM" + (cAlias)->ZM0_PRTCOM
			(cAlias)->(MSUNLOCK())

			(cAlias)->(dbSkip())
		End
		(cAlias)->(dbGoTop())

		cCadastro := "Balan็as"

		//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		//ณ Montagem dos parโmetros para cria็ใo da tela de exibi็ใoณ
		//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		aSize := MsAdvSize()
		AAdd(aObjects, {100, 040, .T., .F.})
		AAdd(aObjects, {100, 060, .T., .F.})
		aInfo := {aSize[1], aSize[2], aSize[3]/2, aSize[4]/2, 5, 5}
		aPosObj := MsObjSize(aInfo, aObjects, .T.)

		//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		//ณInicia montagem do dialog se apresenta็ใo das balan็as disponiveisณ
		//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		oDlgBal := MSDialog():New( 089,232,aPosObj[1,1] + 312,845,"Configura็ใo de Balan็a",,,.F.,,,,,,.T.,,,.T. )
		oDlgBal:bInit := {|| ENCHOICEBAR(oDlgBal, {|| (nOpc := 1, nItem := (cAlias)->(RECNO()), oDlgBal:End())}, {|| (nOpc := 2, oDlgBal:End())},.F.,{})}
		oBrw := MsSelect():New(cAlias,"","", aVwZM0,@lInverte,@cMarca,{aPosObj[1,1],001,aPosObj[1,1]+092,309},,,oDlgBal)
		oDlgBal:Activate(,,,.T.)

		//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		//ณCaso o usuario confirmou a balanca selecionada, gera o arquivo ณ
		//ณde configura็ใo com as informa็๕es da balanca selecionada      ณ
		//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		If nOpc == 1

			//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
			//ณCria o arquivo no local especificadoณ
			//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
			nHdl := fCreate(cArqTxt)

			//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
			//ณVerifica se conseguiu criar o arquivo de configura็ใo no terminalณ
			//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
			If nHdl == -1
				U_GLALL001("Aten็ใo", "Nใo foi possํvel criar o arquivo de configura็ใo da balan็a selecionada.", "Favor efetuar contato com o departamento de TI e informar o ocorrido.")
			Else
				//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				//ณExecuta procedimentos de grava็ใo da balan็a selecionadaณ
				//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				dbSelectArea(cAlias)
				(cAlias)->(dbGoTo(nItem))

				cBalanca := (cAlias)->ZM0_COD
				cLin := Stuff(cEOL, 01, TAMSX3("ZM0_COD")[1], cBalanca)

				If fWrite(nHdl, cLin, LEN(cLin)) != LEN(cLin)
					U_GLALL001("Aten็ใo", "Ocorreram erros no momento da grava็ใo do arquivo de configura็ใo.", "Nใo foi possํvel gravar o arquivo " + cArqTxt)
				EndIf
			EndIf
		Else
			U_GLALL001("Aten็ใo", "Nใo foi efetuada เ configura็ใo de nenhuma balan็a para utiliza็ใo neste terminal.", "Para realizar เ pesagem de veํculos deverแ ser configurado uma balan็a ou utilizado o processo de pesagem manual atrav้s de senha.")
			Return "F00001"
		EndIf

		cCadastro := cCadOld
	EndIf

//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
//ณFecha tabela temporaria caso a mesma esteja em usoณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	If Select(cAlias) > 0
		(cAlias)->(dBCloseArea())
	EndIf

//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
//ณFecha o arquivo de configura็ใoณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	fClose(nHdl)

Return cBalanca





/*

ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
ฑฑษออออออออออัออออออออออหอออออออัออออออออออออออออออออหออออออัอออออออออออออปฑฑ
ฑฑบPrograma  ณLT019LOG    บAutor   ณMarcelo Joner    บ  Data ณ 13/02/2020 บฑฑ
ฑฑฬออออออออออุออออออออออสอออออออฯออออออออออออออออออออสออออออฯอออออออออออออนฑฑ
ฑฑบDesc.     ณRotina responsแvel por verificar เ existencia de logs de    บฑฑ
ฑฑบ          ณrepesagem e pesagem manual.                                 บฑฑ
ฑฑฬออออออออออุออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออนฑฑ
ฑฑบUso       ณ Laticinio                                                  บฑฑ
ฑฑศออออออออออฯออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออผฑฑ
ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿
*/
Static Function LT019LOG()

	Local cQuery		:= ""
	Local cArqTrab		:= ""
	Local cMarca		:= ""
	Local cAliasLOG		:= GetNextAlias()
	Local cCadOld		:= cCadastro
	Local lInverte		:= .F.
	Local lReadOnly		:= .F.
	Local lShare		:= .T.
	Local aVwZM2 		:= {}
	Local aStruct 		:= {}
	Local aSize			:= {}
	Local aObjects		:= {}
	Local aInfo			:= {}
	Local aPosObj		:= {}
	Local nX			:= 0

//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
//ณComp๕e array com os campos para visualiza็ใo dos logsณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	AADD(aVwZM2, {"ZM2_ITEM"	, "", U_LTALLXSX3("ZM2_ITEM")[1]	, U_LTALLXSX3("ZM2_ITEM")[6]  })
	AADD(aVwZM2, {"ZM2_CODUSR"	, "", U_LTALLXSX3("ZM2_CODUSR")[1]	, U_LTALLXSX3("ZM2_CODUSR")[6]})
	AADD(aVwZM2, {"ZM2_NOMUSR"	, "", U_LTALLXSX3("ZM2_NOMUSR")[1]	, U_LTALLXSX3("ZM2_NOMUSR")[6]})
	AADD(aVwZM2, {"ZM2_DTANT"	, "", U_LTALLXSX3("ZM2_DTANT")[1]	, U_LTALLXSX3("ZM2_DTANT")[6] })
	AADD(aVwZM2, {"ZM2_HRANT"	, "", U_LTALLXSX3("ZM2_HRANT")[1]	, U_LTALLXSX3("ZM2_HRANT")[6] })
	AADD(aVwZM2, {"ZM2_VLRANT"	, "", U_LTALLXSX3("ZM2_VLRANT")[1]	, U_LTALLXSX3("ZM2_VLRANT")[6]})
	AADD(aVwZM2, {"ZM2_DATA"	, "", U_LTALLXSX3("ZM2_DATA")[1]	, U_LTALLXSX3("ZM2_DATA")[6]  })
	AADD(aVwZM2, {"ZM2_HORA"	, "", U_LTALLXSX3("ZM2_HORA")[1]	, U_LTALLXSX3("ZM2_HORA")[6]  })
	AADD(aVwZM2, {"ZM2_VALOR"	, "", U_LTALLXSX3("ZM2_VALOR")[1]	, U_LTALLXSX3("ZM2_VALOR")[6] })
	AADD(aVwZM2, {"FUNCAO"		, "", U_LTALLXSX3("ZM2_FUNCAO")[1]	, U_LTALLXSX3("ZM2_FUNCAO")[6]})
	AADD(aVwZM2, {"ZM2_MOTIVO"	, "", U_LTALLXSX3("ZM2_MOTIVO")[1]	, U_LTALLXSX3("ZM2_MOTIVO")[6]})

//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
//ณMonta estrutura da tabela temporaria de apresenta็ใo dos logsณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	AADD(aStruct, {"ZM2_ITEM"	, U_LTALLXSX3("ZM2_ITEM")[3]	, U_LTALLXSX3("ZM2_ITEM")[4]	, U_LTALLXSX3("ZM2_ITEM")[5]  })
	AADD(aStruct, {"ZM2_CODUSR"	, U_LTALLXSX3("ZM2_CODUSR")[3]	, U_LTALLXSX3("ZM2_CODUSR")[4]	, U_LTALLXSX3("ZM2_CODUSR")[5]})
	AADD(aStruct, {"ZM2_NOMUSR"	, U_LTALLXSX3("ZM2_NOMUSR")[3]	, U_LTALLXSX3("ZM2_NOMUSR")[4]	, U_LTALLXSX3("ZM2_NOMUSR")[5]})
	AADD(aStruct, {"ZM2_DTANT"	, U_LTALLXSX3("ZM2_DTANT")[3]	, U_LTALLXSX3("ZM2_DTANT")[4]	, U_LTALLXSX3("ZM2_DTANT")[5] })
	AADD(aStruct, {"ZM2_HRANT"	, U_LTALLXSX3("ZM2_HRANT")[3]	, U_LTALLXSX3("ZM2_HRANT")[4]	, U_LTALLXSX3("ZM2_HRANT")[5] })
	AADD(aStruct, {"ZM2_VLRANT"	, U_LTALLXSX3("ZM2_VLRANT")[3]	, U_LTALLXSX3("ZM2_VLRANT")[4]	, U_LTALLXSX3("ZM2_VLRANT")[5]})
	AADD(aStruct, {"ZM2_DATA"	, U_LTALLXSX3("ZM2_DATA")[3]	, U_LTALLXSX3("ZM2_DATA")[4]	, U_LTALLXSX3("ZM2_DATA")[5]  })
	AADD(aStruct, {"ZM2_HORA"	, U_LTALLXSX3("ZM2_HORA")[3]	, U_LTALLXSX3("ZM2_HORA")[4]	, U_LTALLXSX3("ZM2_HORA")[5]  })
	AADD(aStruct, {"ZM2_VALOR"	, U_LTALLXSX3("ZM2_VALOR")[3]	, U_LTALLXSX3("ZM2_VALOR")[4]	, U_LTALLXSX3("ZM2_VALOR")[5] })
	AADD(aStruct, {"ZM2_FUNCAO"	, U_LTALLXSX3("ZM2_FUNCAO")[3]	, U_LTALLXSX3("ZM2_FUNCAO")[4]	, U_LTALLXSX3("ZM2_FUNCAO")[5]})
	AADD(aStruct, {"FUNCAO"		, U_LTALLXSX3("ZM2_FUNCAO")[3]	, 30							, U_LTALLXSX3("ZM2_FUNCAO")[5]})
	AADD(aStruct, {"ZM2_MOTIVO"	, U_LTALLXSX3("ZM2_MOTIVO")[3]	, U_LTALLXSX3("ZM2_MOTIVO")[4]	, U_LTALLXSX3("ZM2_MOTIVO")[5]})

//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
//ณMonta query de busca dos registros de log de informa็๕es de pesoณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	cQuery := "SELECT ZM2_ITEM,									" + CRLF
	cQuery += "       ZM2_CODUSR,								" + CRLF
	cQuery += "       ZM2_NOMUSR,								" + CRLF
	cQuery += "       ZM2_DTANT,								" + CRLF
	cQuery += "       ZM2_HRANT,								" + CRLF
	cQuery += "       ZM2_VLRANT,								" + CRLF
	cQuery += "       ZM2_DATA,									" + CRLF
	cQuery += "       ZM2_HORA,									" + CRLF
	cQuery += "       ZM2_VALOR,								" + CRLF
	cQuery += "       ZM2_FUNCAO,								" + CRLF
	cQuery += "       '" + SPACE(30) + "' FUNCAO,				" + CRLF
	cQuery += "       ZM2_MOTIVO								" + CRLF

	cQuery += "FROM " + RetSQLName("ZM2") + " ZM2     			" + CRLF

	cQuery += "WHERE ZM2.ZM2_FILIAL  = '" + xFilial("ZM2") + "'	" + CRLF
	cQuery += "  AND ZM2.ZM2_NUM     = '" + M->ZM1_NUM     + "'	" + CRLF
	cQuery += "  AND ZM2.D_E_L_E_T_ <> '*'			  			" + CRLF

	cQuery += "ORDER BY ZM2_NUM, ZM2_ITEM						" + CRLF

	cArqTrab  := CriaTrab( aStruct, .T. )

	If Select(cAliasLOG) > 0
		(cAliasLOG)->(dBCloseArea())
	EndIf

	cQuery := ChangeQuery(cQuery)

	dbUseArea(.T.,"TOPCONN",TcGenQry(,,cQuery),cAliasLOG,.T.,.T.)
	For nX := 1 To len(aStruct)
		If aStruct[nX][2] <> "C" .And. FieldPos(aStruct[nX][1])<>0
			TcSetField(cAliasLOG,aStruct[nX][1],aStruct[nX][2],aStruct[nX][3],aStruct[nX][4])
		EndIf
	Next nX

	Copy TO &cArqTrab
	dBCloseArea()
	dBUseArea( .T.,, cArqTrab, cAliasLOG, lShare, lReadOnly )
	(cAliasLOG)->(dbGoTop())

//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
//ณAtualiza descri็ใo das rotinas\opera็๕esณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	While (cAliasLOG)->(!EOF())
		RECLOCK(cAliasLOG, .F.)
		(cAliasLOG)->FUNCAO := IIF((cAliasLOG)->ZM2_FUNCAO == "1", "Abertura", IIF((cAliasLOG)->ZM2_FUNCAO == "2", "Fechamento", IIF((cAliasLOG)->ZM2_FUNCAO == "3", "Altera็ใo", "Descarte")))
		(cAliasLOG)->(MSUNLOCK())

		(cAliasLOG)->(dbSkip())
	End
	(cAliasLOG)->(dbGoTop())

	cCadastro := "Logs de Pesagem"

//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
//ณCalculo das dimens๕es para interface secundแriaณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	aSize := MsAdvSize(.T.)
	AAdd(aObjects, {100, 100, .T., .T.})
	aInfo := {aSize[1], aSize[2], aSize[3], aSize[4], 2, 2}
	aPosObj := MsObjSize(aInfo, aObjects, .T.)

//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
//ณApresenta interface ao usuแrio com as informa็๕es de logณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	oDlgLog := MSDialog():New(000,000,280,aSize[5], "Log de Pesagens",,,.F.,,,,,,.T.,,,.T. )
	oDlgLog:bInit := {||ENCHOICEBAR(oDlgLog, {|| oDlgLog:End()}, {|| oDlgLog:End()},.F.,{})}
	oBrw := MsSelect():New(cAliasLOG,"","", aVwZM2,@lInverte,@cMarca,{aPosObj[1,1],aPosObj[1,2],(oDlgLog:nClientHeight / 2)-15,(oDlgLog:nClientWidth / 2)-3},,,oDlgLog)
	oDlgLog:Activate(,,,.T.)

	If Select(cAliasLOG) > 0
		(cAliasLOG)->(dBCloseArea())
	EndIf

	cCadastro := cCadOld

Return





/*

ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
ฑฑษออออออออออัออออออออออหอออออออัออออออออออออออออออออหออออออัอออออออออออออปฑฑ
ฑฑบPrograma  ณLT019BLKILL   บAutor  ณMarcelo Joner  บ  Data ณ  14/02/2020 บฑฑ
ฑฑฬออออออออออุออออออออออสอออออออฯออออออออออออออออออออสออออออฯอออออออออออออนฑฑ
ฑฑบDesc.     ณRotina utilizada para permitir ao usuแrio verificar/remover บฑฑ
ฑฑบ          ณเ balan็a configurada na esta็ใo para integra็ใo.           บฑฑ
ฑฑฬออออออออออุออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออนฑฑ
ฑฑบUso       ณ Laticinio                                                  บฑฑ
ฑฑศออออออออออฯออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออผฑฑ
ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿
*/
Static Function LT019BLKILL()

	Local aSize		:= {}
	Local aObjects	:= {}
	Local aInfo		:= {}
	Local aPosObj	:= {}
	Local aCols		:= {}
	Local aHeader	:= {}
	Local cBalanca  := LT019BLSV()
	Local nX
	Private oBrw1
	Private oBtn1

//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
//ณCaso nใo localizou balan็a vinculada ao terminal, aborta o processoณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	If cBalanca == "F00002"
		U_GLALL001("Aten็ใo", "Nใo foi possํvel localizar nenhuma balan็a configurada para integra็ใo neste terminal.", "Este recurso somente pode ser utilizado quando existe uma balan็a configurado no terminal.")
		Return
	Else
		//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		//ณCaso conseguiu ler o c๓digo da balan็a, executa demais regrasณ
		//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		If cBalanca != "F00001"

			//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
			//ณComp๕e o aHeader com os campos do Cadastro Balan็asณ
			//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
			dbSelectArea("SX3")
			SX3->(dbSetOrder(1))
			SX3->(dbSeek("ZM0"))
			While SX3->(!EOF()) .AND. SX3->X3_ARQUIVO == "ZM0"
				If X3Uso(SX3->X3_USADO) .and. cNivel >= SX3->X3_NIVEL
					AADD(aHeader, {Trim(X3Titulo()),;
						SX3->X3_CAMPO,;
						SX3->X3_PICTURE,;
						SX3->X3_TAMANHO,;
						SX3->X3_DECIMAL,;
						SX3->X3_VALID,;
						SX3->X3_USADO,;
						SX3->X3_TIPO,;
						SX3->X3_F3,;
						SX3->X3_CONTEXT,;
						SX3->X3_CBOX,;
						SX3->X3_RELACAO,;
						SX3->X3_WHEN,;
						SX3->X3_VISUAL,;
						SX3->X3_VLDUSER,;
						SX3->X3_VLDUSER})
				EndIf

				SX3->(dbSkip())
			End

			//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
			//ณCarrega informa็๕es referentes ao cadastro da balan็a1ณ
			//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
			dbSelectArea("ZM0")
			ZM0->(dbSetOrder(1))
			ZM0->(dbGoTop())
			If ZM0->(dbSeek(xFilial("ZM0") + cBalanca))
				AADD(aCols, Array(Len(aHeader) + 1))
				For nX := 1 To Len(aHeader)
					If aHeader[nX][10] != "V"
						If !EMPTY(nPosZM0 := FieldPos(aHeader[nX][2]))
							aCols[Len(aCols)][nX] := ZM0->(FieldGet(nPosZM0))
						EndIf
					Else
						aCols[Len(aCols)][nX] := CriaVar(aHeader[nX,2])
					EndIf
				Next
				aCols[Len(aCols)][Len(aHeader) + 1] := .F.
			EndIf

			//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
			//ณCalcula dimens๕es da interface secundแriaณ
			//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
			aSize := MsAdvSize()
			AAdd(aObjects, {100, 040, .T., .F.})
			AAdd(aObjects, {100, 060, .T., .F.})
			aInfo := {aSize[1], aSize[2], aSize[3] / 2, aSize[4] / 2, 5, 5}
			aPosObj := MsObjSize(aInfo, aObjects, .T.)

			//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
			//ณApresenta interface secundแria ao usuแrioณ
			//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
			oDlg2 := MSDialog():New(091,232,aPosObj[1,1] + 283,1030,"Balan็a X Pesagens",,,.F.,,,,,,.T.,,,.T. )
			oDlg2:bInit := {||EnchoiceBar(oDlg2,{|| oDlg2:End()},{|| oDlg2:End()},.F.,{})}
			oGrp1 := TGroup():New( aPosObj[1,1],004,aPosObj[1,1] + 060,396, "Balan็a",oDlg2,CLR_HBLUE,CLR_WHITE,.T.,.F. )
			oBrw1 := MsNewGetDados():New(aPosObj[1,1] + 008,008,aPosObj[1,1] + 056,392,0,'AllwaysTrue()','AllwaysTrue()','',,0,99,'AllwaysTrue()','','AllwaysTrue()',oGrp1,aHeader,aCols)
			oBrw1:SetEditLine(.F.)
			oBtn1 := TButton():New(aPosObj[1,1] + 063,354,"Remover",oGrp1,{|| LT019BLEXC()},037,012,,,,.T.,,"",,,,.F. )
			oBtn1:lVisible := IIF(cBalanca == "F00001", .F., .T.)
			oDlg2:Activate(,,,.T.)
		EndIf
	EndIf

Return





/*

ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
ฑฑษออออออออออัออออออออออหอออออออัออออออออออออออออออออหออออออัอออออออออออออปฑฑ
ฑฑบPrograma  ณLT019BLSV  บAutor  ณMarcelo Joner   บ    Data ณ  14/02/2020 บฑฑ
ฑฑฬออออออออออุออออออออออสอออออออฯออออออออออออออออออออสออออออฯอออออออออออออนฑฑ
ฑฑบDesc.     ณFun็ใo responsแvel por ler o arquivo de configura็ใo da     บฑฑ
ฑฑบ          ณbalan็a e retornar o c๓digo da mesma caso exista.           บฑฑ
ฑฑฬออออออออออุออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออนฑฑ
ฑฑบUso       ณ Laticinio                                                  บฑฑ
ฑฑศออออออออออฯออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออผฑฑ
ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿
*/
Static Function LT019BLSV()

	Local lLoad		:= .F.
	Local cPath		:= GetTempPath()
	Local nBalanca	:= 1

	Private cEOL	:= "CHR(13) + CHR(10)"
	Private cArqTxt	:= cPath + "\balanca" + ALLTRIM(STR(nBalanca)) + ".ini"
	Private nHdl	:= fOpen(cArqTxt)
	Private cAlias	:= GetNextAlias()

	cEOL := &cEOL

//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
//ณExecuta procedimentos de abertura do arquivo de configura็ใo da balan็a utilizadaณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	If nHdl != -1
		lLoad := .T.
	Endif

//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
//ณCaso tenha encontrado o arquivo de configura็ใo da balan็a,    ณ
//ณrealiza os procedimentos de leitura e valida็ใo da configura็ใoณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	If lLoad
		nTamFile := fSeek(nHdl, 0, 2)
		fSeek(nHdl,0,0)
		nTamLin  := LEN(cEOL) + TAMSX3("ZM0_COD")[1]
		cBalanca := SPACE(nTamLin)

		//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		//ณCarrega c๓digo da balan็a presente no arquivoณ
		//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		If fRead(nHdl, @cBalanca, nTamLin) > 0

			//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
			//ณFecha o arquivo de balan็a manipuladoณ
			//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
			If !FCLOSE(nHdl)
				U_GLALL001("Aten็ใo", "Ocorreram erros ao fechar o arquivo de configura็ใo da balan็a.", "Nใo foi possํvel fechar o arquivo " + cArqTxt + "." + CHR(13) + CHR(13) + "Esta falha pode afetar no processo de remo็ใo da integra็ใo da balan็a com เ rotina de pesagens.")
			EndIf
			Return ALLTRIM(cBalanca)
		Else
			//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
			//ณCaso ocorreram erros na leitura do arquivo, alerta o usuarioณ
			//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
			U_GLALL001("Aten็ใo", "Ocorreram erros na leitura do arquivo de configura็ใo da balan็a.", "Nใo foi possํvel ler o arquivo " + cArqTxt)
			Return "F00001"
		EndIf
	Else
		Return "F00002"
	EndIf

//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
//ณFecha o arquivo de balan็a manipuladoณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	If !FCLOSE(nHdl)
		U_GLALL001("Aten็ใo", "Ocorreram erros ao fechar o arquivo de configura็ใo da balan็a", "Nใo foi possํvel fechar o arquivo " + cArqTxt + "." + CHR(13) + CHR(13) + "Esta falha pode afetar no processo de remo็ใo da integra็ใo da balan็a com เ rotina de pesagens.")
	EndIf

Return





/*

ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
ฑฑษออออออออออัออออออออออหอออออออัออออออออออออออออออออหออออออัอออออออออออออปฑฑ
ฑฑบPrograma  ณLT019BLEXC   บAutor  ณMarcelo Joner    บ Data ณ  14/02/2020 บฑฑ
ฑฑฬออออออออออุออออออออออสอออออออฯออออออออออออออออออออสออออออฯอออออออออออออนฑฑ
ฑฑบDesc.     ณFun็ใo responsแvel pela exclusใo do arquivo de configura็ใo บฑฑ
ฑฑบ          ณda balan็a.                                                 บฑฑ
ฑฑฬออออออออออุออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออนฑฑ
ฑฑบUso       ณ Laticinio                                                  บฑฑ
ฑฑศออออออออออฯออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออผฑฑ
ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿
*/
Static Function LT019BLEXC()

	Local nBalanca	:= 1
	Local cPath		:= GetTempPath()
	Local cArqTxt 	:= cPath + "balanca" + ALLTRIM(STR(nBalanca)) + ".ini"

//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฟ
//ณExecuta os procedimentos de exclusใo do arquivo de integra็ใo da balan็a com a rotina de romaneio de grใosณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤู
	If FERASE(cArqTxt) == -1
		Aviso("Aten็ใo", "Nใo foi possํvel remover o arquivo: " + CHR(13) + CHR(13) + cArqTxt, {"OK"}, 2)
	Else
		Aviso("Aten็ใo", "O arquivo: " + CHR(13) + CHR(13) + cArqTxt + CHR(13) + CHR(13) + " referente เ integra็ใo com a balan็a " + STRZERO(nBalanca, 2) + " foi excluํdo com sucesso.", {"OK"}, 2)

		//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		//ณExecuta os procedimentos de atualiza็ใo dos componentes na telaณ
		//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		oBrw1:aCols := {}
		oBrw1:oBrowse:Refresh()
		oBtn1:lVisible := .F.
		oBtn1:Refresh()
	EndIf

Return





/*

ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
ฑฑษออออออออออัออออออออออหอออออออัออออออออออออ`ออออออออหออออออัออออออออออออปฑฑ
ฑฑบPrograma  ณLT019TP   บAutor  ณMarcelo Joner        บ Data ณ 14/02/2020 บฑฑ
ฑฑฬออออออออออุออออออออออสอออออออฯออออออออออออออออออออสออออออฯอออออออออออออนฑฑ
ฑฑบDesc.     ณFun็ใo vinculada como valida็ใo do campo ZM1_TIPO.          บฑฑ
ฑฑบ          ณ                                                            บฑฑ
ฑฑฬออออออออออุออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออนฑฑ
ฑฑบUso       ณ Laticinio                                                  บฑฑ
ฑฑศออออออออออฯออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออผฑฑ
ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿
*/
User Function LT019TP()
	Local lRet   := .T.
	Local cTpPrd := POSICIONE("SB1", 1, xFilial("SB1") + M->ZM1_PROD, "B1_TIPO")
	Local lTrava := SuperGetMV("MV_ZL00012",,.F.)
	Local cPrdSer := GETMV("MV_ZL00013",, "")
	Local cClifor := ""

//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
//ณExecuta procedimentos de analise/substituํ็ใo da consulta padrใoณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	If M->ZM1_TIPO == "1" .OR. (ALLTRIM(M->ZM1_PROD) $ cPrdSer)
		aTrocaF3 := {{"ZM1_CLIFOR",	"SA2"}}
		cCliFor  := POSICIONE("SA2", 1, xFilial("SA2") + M->ZM1_CLIFOR, "A2_COD")
	Else
		aTrocaF3 := {{"ZM1_CLIFOR",	"SA1"}}
		cCliFor  := POSICIONE("SA1", 1, xFilial("SA1") + M->ZM1_CLIFOR, "A1_COD")
	EndIf

//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
//ณGarante que os campos de CODIGO, LOJA e NOME sejam resetadosณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	If Empty(cClifor)
		M->ZM1_CLIFOR := CRIAVAR("ZM1_CLIFOR")
		M->ZM1_LOJA   := CRIAVAR("ZM1_LOJA")
		M->ZM1_NOME   := CRIAVAR("ZM1_NOME")
	EndIf
//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
//ณVerifica a existencia de CARGA para alimentat os campos e travar a pesagemณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

	If M->ZM1_TIPO == "2" .AND. ( cTpPrd == "PA" .OR. Empty(cTpPrd)) .AND. ( ALLTRIM(M->ZM1_PROD) # cPrdSer )

		dbSelectArea("ZN1")
		ZN1->(dbSetOrder(3))
		ZN1->(DbGoBottom())

		If ZN1->(dbSeek(xFilial("ZN1") + ALLTRIM(M->ZM1_PLACA)+' '+DTOS(M->ZM1_DATA)))
			dbSelectArea("SC5")
			SC5->(dbSetOrder(12))
			SC5->(dbGoTop())
			If SC5->(dbSeek(xFilial("SC5") + ALLTRIM(ZN1->ZN1_SIMULA)))	
			//ZN1 - ASSOC VEIC
			//SC5 C5_X_SIMU
			M->ZM1_CLIFOR := SC5->C5_CLIENTE
			M->ZM1_LOJA   := SC5->C5_LOJACLI
			M->ZM1_NOME   := POSICIONE("SA1",1,XFILIAL("SA1")+M->ZM1_CLIFOR+M->ZM1_LOJA,"A1_NOME")
			M->ZM1_PEDCOM := SC5->C5_NUM
			M->ZM1_NFCOM := SC5->C5_NOTA
			M->ZM1_SRCOM := SC5->C5_SERIE
			M->ZM1_TIPO := "2"
			//M->ZM1_NOMMOT := ZN1->ZN1_NOMMOT

			dbSelectArea("SC6")
			SC6->(dbSetOrder(1))
			SC6->(dbGoTop())
			If SC6->(dbSeek(xFilial("SC6") + ALLTRIM(SC5->C5_NUM)))	
				M->ZM1_PROD := SC6->C6_PRODUTO
				
			EndIf
			

		EndIf
		ElseIf lTrava
			Aviso("Aten็ใo", "Nใo foi possํvel encontrar a carga nesse dia para a placa: " + CHR(13) + CHR(13) + M->ZM1_PLACA, {"OK"}, 2)
			lRet := !lTrava
		EndIf
	EndIf
Return lRet


/*

ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
ฑฑษออออออออออัออออออออออหอออออออัออออออออออออ`ออออออออหออออออัออออออออออออปฑฑ
ฑฑบPrograma  ณLT019CG   บAutor  ณAlexandre Longhinotti บData ณ 14/02/2020 บฑฑ
ฑฑฬออออออออออุออออออออออสอออออออฯออออออออออออออออออออสออออออฯอออออออออออออนฑฑ
ฑฑบDesc.     ณFun็ใo verifica a existencia de carga para a placa informadaบฑฑ
ฑฑบ          ณ na valida็ใo do campo                                      บฑฑ
ฑฑฬออออออออออุออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออนฑฑ
ฑฑบUso       ณ Laticinio                                                  บฑฑ
ฑฑศออออออออออฯออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออผฑฑ
ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿
*/
User Function LT019CG()
	Local lRet   := .T.
/*Local lTrava := SuperGetMV("MV_ZL00012",,.F.)
Local cClifor := ""*/


//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
//ณVerifica a existencia de CARGA para alimentar os campos da pesagem            ณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	dbSelectArea("ZN1")
	ZN1->(dbSetOrder(3))
	ZN1->(DbGoBottom())
	If ZN1->(dbSeek(xFilial("ZN1") + ALLTRIM(M->ZM1_PLACA)+' '+DTOS(M->ZM1_DATA)))
			
		dbSelectArea("SC5")
		SC5->(dbSetOrder(12))
		SC5->(dbGoTop())
		If SC5->(dbSeek(xFilial("SC5") + ALLTRIM(ZN1->ZN1_SIMULA)))	
			//ZN1 - ASSOC VEIC
			//SC5 C5_X_SIMU
			M->ZM1_CLIFOR := SC5->C5_CLIENTE
			M->ZM1_LOJA   := SC5->C5_LOJACLI
			M->ZM1_NOME   := POSICIONE("SA1",1,XFILIAL("SA1")+M->ZM1_CLIFOR+M->ZM1_LOJA,"A1_NOME")
			M->ZM1_PEDCOM := SC5->C5_NUM
			M->ZM1_NFCOM := SC5->C5_NOTA
			M->ZM1_SRCOM := SC5->C5_SERIE
			M->ZM1_TIPO := "2"
			//M->ZM1_NOMMOT := ZN1->ZN1_NOMMOT

			dbSelectArea("SC6")
			SC6->(dbSetOrder(1))
			SC6->(dbGoTop())
			If SC6->(dbSeek(xFilial("SC6") + ALLTRIM(SC5->C5_NUM)))	
				M->ZM1_PROD := SC6->C6_PRODUTO
				
			EndIf
			

		EndIf
	Else
		U_LT019PRD()
	EndIf
 

Return lRet

/*

ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
ฑฑษออออออออออัออออออออออหอออออออัออออออออออออ`ออออออออหออออออัออออออออออออปฑฑ
ฑฑบPrograma  ณLT019CG2  บAutor  ณAlexandre Longhinotti บData ณ 14/02/2020 บฑฑ
ฑฑฬออออออออออุออออออออออสอออออออฯออออออออออออออออออออสออออออฯอออออออออออออนฑฑ
ฑฑบDesc.     ณFun็ใo verifica a existencia de carga para a placa informadaบฑฑ
ฑฑบ          ณ na confirma็ใo dos dados iniciais da pesagem               บฑฑ
ฑฑฬออออออออออุออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออนฑฑ
ฑฑบUso       ณ Laticinio                                                  บฑฑ
ฑฑศออออออออออฯออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออผฑฑ
ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿
*/
User Function LT019CG2()
	Local lRet   := .T.

	dbSelectArea("ZN1")
	ZN1->(dbSetOrder(3))
	ZN1->(DbGoBottom())
	If !ZN1->(dbSeek(xFilial("ZN1") + ALLTRIM(M->ZM1_PLACA)+' '+DTOS(M->ZM1_DATA)))
		lRet   := .F.
	EndIf

Return lRet


/*

ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
ฑฑษออออออออออัออออออออออหอออออออัออออออออออออ`ออออออออหออออออัออออออออออออปฑฑ
ฑฑบPrograma  ณLT019SHW   บAutor  ณMarcelo Joner       บ Data ณ 17/02/2020 บฑฑ
ฑฑฬออออออออออุออออออออออสอออออออฯออออออออออออออออออออสออออออฯอออออออออออออนฑฑ
ฑฑบDesc.     ณFun็ใo referente เ interface para informa็ใo da placa do    บฑฑ
ฑฑบ          ณveํculo antes da abertura da pesagem.                       บฑฑ
ฑฑฬออออออออออุออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออนฑฑ
ฑฑบUso       ณ Laticinio                                                  บฑฑ
ฑฑศออออออออออฯออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออผฑฑ
ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿
*/
Static Function LT019SHW()

	Local aArea			:= GetArea()
	Local aSize			:= {}
	Local aObjects		:= {}
	Local aInfo			:= {}
	Local aPosObj		:= {}
	Local nOpc			:= 2
	Local lRet			:= .F.
	Local lShare		:= .T.
	Local lReadOnly		:= .F.
	Local aItems:= {'1=Descarga','2=Carga'}
	Local nX
//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
//ณ Montagem dos parโmetros para cria็ใo da tela de exibi็ใoณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	aSize := MsAdvSize()
	AAdd(aObjects, {100, 040, .T., .F.})
	AAdd(aObjects, {100, 060, .T., .F.})
	aInfo := { aSize[ 1 ], aSize[ 2 ], aSize[ 3 ] / 2, aSize[ 4 ] / 2, 5, 5 }
	aPosObj := MsObjSize(aInfo, aObjects, .T.)

//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
//ณMonta dialog para informar เ placa, produto e tipoณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	cCombo1:= aItems[1]


	oDlgY := MSDialog():New(000,000,0130,280,"Abertura - Informe a Placa",,,.F.,,,,,,.T.,,,.T. )
	oSayPlaca := TSay():New(010,004,{|| "Placa"},oDlgY,,,.F.,.F.,.F.,.T.,CLR_HBLUE,CLR_WHITE,032,008)
	@ 009, 040 MSGET oPlaca  	VAR M->ZM1_PLACA VALID U_LT019CG()	PICTURE PesqPict("ZM1", "ZM1_PLACA") OF oDlgY WHEN .T. PIXEL SIZE 030,008 HASBUTTON

	oSayProd := TSay():New(022,004,{|| "Produto"},oDlgY,,,.F.,.F.,.F.,.T.,CLR_HBLUE,CLR_WHITE,032,008)
	@ 022, 040 MSGET oProd  	VAR M->ZM1_PROD  F3 "SB1" VALID U_LT019VPD() PICTURE PesqPict("SB1", "B1_COD")  SIZE 055,008 OF oDlgY WHEN .T. PIXEL SIZE 030,008 HASBUTTON
	If ExistTrigger('ZM1_PROD')
		RunTrigger(1,,nil,,'ZM1_PROD')
	EndIf
	oCombo1 := TComboBox():New(036,012,{|u|if(PCount()>0,M->ZM1_TIPO:=u,M->ZM1_TIPO)},aItems,50,20,oDlgY,,,,,,.T.,,,,,,,,,'M->ZM1_TIPO','Tipo        ', 2)
	oCombo1:SetHeight( 23 )

	oBtnPlaca := TButton():New(036, 90, "&Confirmar", oDlgY, {|| IIF(U_LT019TP(),(nOpc := 1, oDlgY:End()),)}, 030, 012,,,, .T.,,"",,,, .F.)

	oDlgY:Activate(,,,.T.)


//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
//ณConfirmando เ tela, verifica pesagem anterior para placa informadaณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	If nOpc == 1
		lRet := .T.

		IF !U_LT019CG2()
			//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
			//ณMonta estrutura da tabela temporariaณ
			//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
			aStruct := ZM1->(dbStruct())
			cAliasPLA := GetNextAlias()

			//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
			//ณBusca ๚ltimo romaneio feito com เ placa informadaณ
			//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
			cQuery := "SELECT ZM1.*																	" + CRLF

			cQuery += "FROM " + RetSQLName("ZM1") + " ZM1											" + CRLF

			cQuery += "WHERE ZM1.ZM1_FILIAL  = '" + xFilial("ZM1") + "'								" + CRLF
			cQuery += "  AND ZM1.ZM1_NUM     = (SELECT MAX(ZM12.ZM1_NUM) ZM1_NUM					" + CRLF
			cQuery += "                           FROM " + RetSQLName("ZM1") + " ZM12				" + CRLF
			cQuery += "                          WHERE ZM12.ZM1_FILIAL  = '" + xFilial("ZM1") + "'	" + CRLF
			cQuery += "                            AND ZM12.ZM1_PLACA   = '" + M->ZM1_PLACA   + "'	" + CRLF
			cQuery += "                            AND ZM12.D_E_L_E_T_ <> '*')						" + CRLF

			cTabTMP  := CriaTrab(aStruct, .T.)

			If Select(cAliasPLA) > 0
				(cAliasPLA)->(dbCloseArea())
			EndIf

			cQuery := ChangeQuery(cQuery)

			dbUseArea(.T.,"TOPCONN",TcGenQry(,,cQuery),cAliasPLA,.T.,.T.)
			For nX := 1 To len(aStruct)
				If aStruct[nX][2] <> "C" .And. FieldPos(aStruct[nX][1])<>0
					TcSetField(cAliasPLA,aStruct[nX][1],aStruct[nX][2],aStruct[nX][3],aStruct[nX][4])
				EndIf
			Next nX

			Copy TO &cTabTMP
			dBCloseArea()
			dBUseArea(.T.,, cTabTMP, cAliasPLA, lShare, lReadOnly)
			(cAliasPLA)->(dbGoTop())

			//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
			//ณCarrega informa็๕es caso encontrou pesagem anterior do veํculoณ
			//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
			If !EMPTY((cAliasPLA)->ZM1_NUM)
				lPeso := .T.
				//M->ZM1_TIPO		:= (cAliasPLA)->ZM1_TIPO
				//M->ZM1_PROD		:= (cAliasPLA)->ZM1_PROD
				//M->ZM1_DESC		:= (cAliasPLA)->ZM1_DESC
				M->ZM1_CLIFOR	:= (cAliasPLA)->ZM1_CLIFOR
				M->ZM1_LOJA		:= (cAliasPLA)->ZM1_LOJA
				M->ZM1_NOME		:= (cAliasPLA)->ZM1_NOME
				M->ZM1_TRANSP	:= (cAliasPLA)->ZM1_TRANSP
				M->ZM1_DTRANS	:= POSICIONE("SA4", 1, xFilial("SA4") + M->ZM1_TRANSP, "A4_NOME")
				M->ZM1_REBOQ1	:= (cAliasPLA)->ZM1_REBOQ1
				M->ZM1_REBOQ2	:= (cAliasPLA)->ZM1_REBOQ2
				M->ZM1_CODVEI	:= (cAliasPLA)->ZM1_CODVEI
				M->ZM1_CODMOT	:= (cAliasPLA)->ZM1_CODMOT
				M->ZM1_NOMMOT	:= (cAliasPLA)->ZM1_NOMMOT
				M->ZM1_NRTNQ	:= (cAliasPLA)->ZM1_NRTNQ

				//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				//ณExecuta fun็ใo para garantir atualiza็ใo de campos conforme defini็๕es do cadastro do VEICULOณ
				//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
				U_LT019VPD()
			EndIf
		EndIf
	Else
		//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		//ณEstorna n๚mero do romaneio que nใo serแ abertoณ
		//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		ZM1->(ROLLBACKSX8())
	EndIf

	RestArea(aArea)

Return lRet

/*

ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
ฑฑษออออออออออัออออออออออหอออออออัออออออออออออ`ออออออออหออออออัออออออออออออปฑฑ
ฑฑบPrograma  ณLT019PRD  บAutor  ณAlexandre Longhi     บ Data ณ 17/02/2020 บฑฑ
ฑฑฬออออออออออุออออออออออสอออออออฯออออออออออออออออออออสออออออฯอออออออออออออนฑฑ
ฑฑบDesc.     ณFun็ใo verifica pesagem anterior para placa e prd informada บฑฑ
ฑฑบ          ณ na rotina de pesagens.                                     บฑฑ
ฑฑฬออออออออออุออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออนฑฑ
ฑฑบUso       ณ Laticinio                                                  บฑฑ
ฑฑศออออออออออฯออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออผฑฑ
ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿
*/
User Function LT019PRD()
	Local lRet			:= .T.
	Local lShare		:= .T.
	Local lReadOnly		:= .F.
	Local nX
//Local cPrdLin	:= GETMV("MV_ZL00005",, "")

	//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	//ณMonta estrutura da tabela temporariaณ
	//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	aStruct := ZM1->(dbStruct())
	cAliasPLA := GetNextAlias()

	//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	//ณBusca ๚ltimo romaneio feito com เ placa informadaณ
	//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	cQuery := "SELECT ZM1.*																	" + CRLF

	cQuery += "FROM " + RetSQLName("ZM1") + " ZM1											" + CRLF

	cQuery += "WHERE ZM1.ZM1_FILIAL  = '" + xFilial("ZM1") + "'								" + CRLF
	cQuery += "  AND ZM1.ZM1_NUM     = (SELECT MAX(ZM12.ZM1_NUM) ZM1_NUM					" + CRLF
	cQuery += "                           FROM " + RetSQLName("ZM1") + " ZM12				" + CRLF
	cQuery += "                          WHERE ZM12.ZM1_FILIAL  = '" + xFilial("ZM1") + "'	" + CRLF
	cQuery += "                            AND ZM12.ZM1_PLACA   = '" + M->ZM1_PLACA   + "'	" + CRLF
	cQuery += "                            AND ZM12.D_E_L_E_T_ <> '*')						" + CRLF

	cTabTMP  := CriaTrab(aStruct, .T.)

	If Select(cAliasPLA) > 0
		(cAliasPLA)->(dbCloseArea())
	EndIf

	cQuery := ChangeQuery(cQuery)

	dbUseArea(.T.,"TOPCONN",TcGenQry(,,cQuery),cAliasPLA,.T.,.T.)
	For nX := 1 To len(aStruct)
		If aStruct[nX][2] <> "C" .And. FieldPos(aStruct[nX][1])<>0
			TcSetField(cAliasPLA,aStruct[nX][1],aStruct[nX][2],aStruct[nX][3],aStruct[nX][4])
		EndIf
	Next nX

	Copy TO &cTabTMP
	dBCloseArea()
	dBUseArea(.T.,, cTabTMP, cAliasPLA, lShare, lReadOnly)
	(cAliasPLA)->(dbGoTop())

	//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	//ณCarrega informa็๕es caso encontrou pesagem anterior do veํculoณ
	//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	If !EMPTY((cAliasPLA)->ZM1_NUM)
		lPeso := .T.
		M->ZM1_TIPO		:= (cAliasPLA)->ZM1_TIPO
		M->ZM1_PROD		:= (cAliasPLA)->ZM1_PROD
		M->ZM1_DESC		:= (cAliasPLA)->ZM1_DESC
		M->ZM1_CLIFOR	:= (cAliasPLA)->ZM1_CLIFOR
		M->ZM1_LOJA		:= (cAliasPLA)->ZM1_LOJA
		M->ZM1_NOME		:= (cAliasPLA)->ZM1_NOME
		M->ZM1_TRANSP	:= (cAliasPLA)->ZM1_TRANSP
		M->ZM1_DTRANS	:= POSICIONE("SA4", 1, xFilial("SA4") + M->ZM1_TRANSP, "A4_NOME")
		M->ZM1_REBOQ1	:= (cAliasPLA)->ZM1_REBOQ1
		M->ZM1_REBOQ2	:= (cAliasPLA)->ZM1_REBOQ2
		M->ZM1_CODVEI	:= (cAliasPLA)->ZM1_CODVEI
		M->ZM1_CODMOT	:= (cAliasPLA)->ZM1_CODMOT
		M->ZM1_NOMMOT	:= (cAliasPLA)->ZM1_NOMMOT
		M->ZM1_NRTNQ	:= (cAliasPLA)->ZM1_NRTNQ
	EndIf

Return lRet
/*

ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
ฑฑษออออออออออัออออออออออหอออออออัออออออออออออ`ออออออออหออออออัออออออออออออปฑฑ
ฑฑบPrograma  ณLT019LIN  บAutor  ณMarcelo Joner        บ Data ณ 17/02/2020 บฑฑ
ฑฑฬออออออออออุออออออออออสอออออออฯออออออออออออออออออออสออออออฯอออออออออออออนฑฑ
ฑฑบDesc.     ณFun็ใo de valida็ใo vinculada ao campo referente hแ linha   บฑฑ
ฑฑบ          ณde coleta na rotina de pesagens.                            บฑฑ
ฑฑฬออออออออออุออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออนฑฑ
ฑฑบUso       ณ Laticinio                                                  บฑฑ
ฑฑศออออออออออฯออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออผฑฑ
ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿
*/
User Function LT019LIN()

	Local lRet		:= .T.

//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
//ณExecuta demais regras caso tenha sido informado uma linhaณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	If !Vazio()
		If ExistCpo("ZL0")
			dbSelectArea("ZL0")
			ZL0->(dbSetOrder(1))
			ZL0->(dbGoTop())
			ZL0->(dbSeek(xFilial("ZL0") + M->ZM1_CODLIN))
			If ZL0->ZL0_TRANSP != M->ZM1_TRANSP
				//U_GLALL001("Aten็ใo", "A linha informada nใo estแ vinculada ao transportador da pesagem.", "Favor informar uma linha vinculada ao transportador.")
				If Aviso("Aten็ใo", "A linha informada nใo estแ vinculada ao transportador da pesagem. Deseja alterar o transportador?" , {"&Sim", "&Nใo"}, 2) == 2
					lRet := .F.
				Else
					M->ZM1_TRANSP := ZL0->ZL0_TRANSP
					M->ZM1_DTRANS := ZL0->ZL0_NOMTRP
					M->ZM1_CLIFOR := POSICIONE("SA4", 1, xFilial("SA4") + ZL0->ZL0_TRANSP, "A4_X_FORN")
					M->ZM1_LOJA   := POSICIONE("SA4", 1, xFilial("SA4") + ZL0->ZL0_TRANSP, "A4_X_LOJF")
					M->ZM1_NOME   := POSICIONE("SA4", 1, xFilial("SA4") + ZL0->ZL0_TRANSP, "A4_NOME")
					lRet := U_LTMOV9MT()
				EndIf
			ElseIf !U_LTMOV9MT()
				lRet := .F.
			EndIf

		Else
			lRet := .F.
		EndIf
	EndIf

Return lRet





/*

ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
ฑฑษออออออออออัออออออออออหอออออออัออออออออออออ`ออออออออหออออออัออออออออออออปฑฑ
ฑฑบPrograma  ณLT019MRK  บAutor  ณMarcelo Joner        บ Data ณ 15/04/2020 บฑฑ
ฑฑฬออออออออออุออออออออออสอออออออฯออออออออออออออออออออสออออออฯอออออออออออออนฑฑ
ฑฑบDesc.     ณFun็ใo de valida็ใo vinculada ao grid de analises de quali- บฑฑ
ฑฑบ          ณdade presente na sessใo de Pesagem.                         บฑฑ
ฑฑฬออออออออออุออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออนฑฑ
ฑฑบUso       ณ Laticinio                                                  บฑฑ
ฑฑศออออออออออฯออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออผฑฑ
ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿
*/
Static Function LT019MRK()

	Local nPos	:= (cAliasQLD)->(RECNO())

//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
//ณPermite marcar apenas um registro do grid por vezณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	If !EMPTY((cAliasQLD)->OK)

		//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		//ณVerifica se o registro selecionado esta com status DESCARTEณ
		//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		If ALLTRIM((cAliasQLD)->ZM3_STATUS) == "DESCARTE"
			(cAliasQLD)->(dbGoTop())
			While (cAliasQLD)->(!EOF())
				If (cAliasQLD)->(RECNO()) <> nPos
					RECLOCK(cAliasQLD, .F.)
					(cAliasQLD)->OK := SPACE(2)
					(cAliasQLD)->(MSUNLOCK())
				EndIf
				(cAliasQLD)->(dbSkip())
			End
			(cAliasQLD)->(dbGoTo(nPos))
			oMarQld:oBrowse:Refresh()
		Else
			//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
			//ณAlerta o usuแiro pois เ anแlise selecionada nใo estแ como descarteณ
			//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
			U_GLALL001("Aten็ใo", "A anแlise de qualidade selecionada nใo pode ser utilizada.", "Somente ้ possํvel utilizar as anแlises que estejam com o status como DESCARTE.")

			//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
			//ณRemove เ marca็ใo da anแlise de qualidade utilizadaณ
			//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
			RECLOCK(cAliasQLD, .F.)
			(cAliasQLD)->OK := SPACE(2)
			(cAliasQLD)->(MSUNLOCK())
		EndIf
	EndIf

Return





/*

ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
ฑฑษออออออออออัออออออออออหอออออออัออออออออออออ`ออออออออหออออออัออออออออออออปฑฑ
ฑฑบPrograma  ณLT019VPD  บAutor  ณMarcelo Joner        บ Data ณ 05/05/2020 บฑฑ
ฑฑฬออออออออออุออออออออออสอออออออฯออออออออออออออออออออสออออออฯอออออออออออออนฑฑ
ฑฑบDesc.     ณFun็ใo responsแvel pela valida็ใo do c๓digo do produto na   บฑฑ
ฑฑบ          ณinterface da Pesagem.                                       บฑฑ
ฑฑฬออออออออออุออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออนฑฑ
ฑฑบUso       ณ Laticinio                                                  บฑฑ
ฑฑศออออออออออฯออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออผฑฑ
ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿
*/
User Function LT019VPD()

	Local lRet		:= .F.
	Local cPrdLin	:= GETMV("MV_ZL00005",, "")
	Local cPrdSer 	:= GETMV("MV_ZL00013",, "")

//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
//ณExecuta demais regras caso o c๓digo informado seja vแlidoณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	If VAZIO() .Or. EXISTCPO("SB1")
		lRet := .T.

		//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		//ณExecuta regras para busca das informa็๕es do Veํculo pela Placaณ
		//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
		If !EMPTY(M->ZM1_PROD)
			If (ALLTRIM(M->ZM1_PROD) $ cPrdSer)
				M->ZM1_TIPO := "2"
			EndIf
			M->ZM1_DESC := POSICIONE("SB1", 1, xFilial("SB1") + M->ZM1_PROD, "B1_DESC")
			//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
			//ณCaso seja produto com controle de LINHA, puxa informa็๕es do VEICULO para เ pesagemณ
			//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
			If ALLTRIM(M->ZM1_PROD) $ cPrdLin
				dbSelectArea("DA3")
				DA3->(dbSetOrder(3))
				DA3->(dbGoTop())
				If DA3->(dbSeek(xFilial("DA3") + SUBSTR(M->ZM1_PLACA, 1, TAMSX3("DA3_PLACA")[1])))
					M->ZM1_CODVEI := DA3->DA3_COD
					M->ZM1_NRTNQ  := DA3->DA3_X_QTAN

					//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
					//ณObt้m informa็๕es do FORNECEDOR vinculado ao VEICULOณ
					//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
					If !EMPTY(DA3->DA3_CODFOR) .AND. !EMPTY(DA3->DA3_LOJFOR)
						M->ZM1_CLIFOR	:= DA3->DA3_CODFOR
						M->ZM1_LOJA		:= DA3->DA3_LOJFOR
						M->ZM1_NOME		:= POSICIONE("SA2", 1, xFilial("SA2") + DA3->DA3_CODFOR + DA3->DA3_LOJFOR, "A2_NOME")
					EndIf

					//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
					//ณObt้m informa็๕es do TRANSPORTADOR vinculado ao VEICULOณ
					//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
					If !EMPTY(DA3->DA3_X_TRP)
						M->ZM1_TRANSP	:= DA3->DA3_X_TRP
						M->ZM1_DTRANS	:= POSICIONE("SA4", 1, xFilial("SA4") + DA3->DA3_X_TRP, "A4_NOME")
					EndIf

					//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
					//ณObt้m informa็๕es do MOTORISTA vinculado ao VEICULOณ
					//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
					If !EMPTY(DA3->DA3_MOTORI)
						M->ZM1_CODMOT	:= DA3->DA3_MOTORI
						M->ZM1_NOMMOT	:= POSICIONE("DA4", 1, xFilial("DA4") + DA3->DA3_MOTORI, "DA4_NOME")
					EndIf
				EndIf
			EndIf
		EndIf
	EndIf

Return lRet





/*

ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
ฑฑษออออออออออัออออออออออหอออออออัออออออออออออ`ออออออออหออออออัออออออออออออปฑฑ
ฑฑบPrograma  ณLTMOV9TP  บAutor  ณMarcelo Joner        บ Data ณ 07/05/2020 บฑฑ
ฑฑฬออออออออออุออออออออออสอออออออฯออออออออออออออออออออสออออออฯอออออออออออออนฑฑ
ฑฑบDesc.     ณFun็ใo responsแvel pela atualiza็ใo do ZM1_TIPO conforme เ  บฑฑ
ฑฑบ          ณavalia็ใo realizada sob os campos de peso entrada\saํda.    บฑฑ
ฑฑฬออออออออออุออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออนฑฑ
ฑฑบUso       ณ Laticinio                                                  บฑฑ
ฑฑศออออออออออฯออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออผฑฑ
ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿
*/
User Function LTMOV9TP()

//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
//ณCaso esteja editando manualmente KG ENTRADA ou KG SAIDA valida pesoณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	If "ZM1_KGINI" $ ALLTRIM(READVAR()) .OR. "ZM1_KGFIN" $ ALLTRIM(READVAR())
		If !POSITIVO()
			Return .F.
		EndIf
	EndIf

//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
//ณPeso de SAIDA maior que peso de ENTRADA - TIPO CARGAณ
//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	If M->ZM1_KGFIN > 0
		If M->ZM1_KGFIN > M->ZM1_KGINI
			M->ZM1_TIPO  := "2"
			M->ZM1_KGBRT := ROUND((M->ZM1_KGFIN - M->ZM1_KGINI), TAMSX3("ZM1_KGBRT")[2])
		Else
			//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
			//ณPeso ENTRADA maior que peso SAอDA - TIPO DESCARGAณ
			//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
			M->ZM1_TIPO  := "1"
			M->ZM1_KGBRT := ROUND((M->ZM1_KGINI - M->ZM1_KGFIN), TAMSX3("ZM1_KGBRT")[2])
		EndIf
	EndIf
Return .T.

/*

ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
ฑฑษออออออออออัออออออออออหอออออออัออออออออออออ`ออออออออหออออออัออออออออออออปฑฑ
ฑฑบPrograma  ณLTMOV9MT  บAutor  ณMarcelo Joner        บ Data ณ 26/05/2020 บฑฑ
ฑฑฬออออออออออุออออออออออสอออออออฯออออออออออออออออออออสออออออฯอออออออออออออนฑฑ
ฑฑบDesc.     ณFun็ใo de valida็ใo de Mov Transportador quando a linha de  บฑฑ
ฑฑบ          ณfor informada					                              บฑฑ
ฑฑฬออออออออออุออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออนฑฑ
ฑฑบUso       ณ Laticinio                                                  บฑฑ
ฑฑศออออออออออฯออออออออออออออออออออออออออออออออออออออออออออออออออออออออออออผฑฑ
ฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑฑ
฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿฿
*/
User Function LTMOV9MT(cPlaca)

	Local lRet		:= .T.
	DEFAULT cPlaca := M->ZM1_PLACA
	//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	//ณExecuta valida็ใo quando trata-se de edi็ใo da PLACAณ
	//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ

	If !EMPTY(cPlaca)
		cQuery := "SELECT COUNT(*) TOTAL									" + CRLF
		cQuery += "FROM " + RetSQLName("ZL7") + " ZL7						" + CRLF
		cQuery += "WHERE ZL7.ZL7_FILIAL  = '" + xFilial("ZL7")    	+ "'	" + CRLF
		cQuery += "  AND ZL7.ZL7_TRANSP  = '" + M->ZM1_TRANSP     	+ "'	" + CRLF
		cQuery += "  AND ZL7.ZL7_LINHA   = '" + M->ZM1_CODLIN      	+ "'	" + CRLF
		cQuery += "  AND ZL7.ZL7_PLACA   = '" + cPlaca 	  			+ "'	" + CRLF
		cQuery += "  AND ZL7.ZL7_DATA    = '" + DTOS(M->ZM1_DATA)	+ "'	" + CRLF
		cQuery += "  AND ZL7.D_E_L_E_T_ <> '*'								" + CRLF

		cAliasTMP := GetNextAlias()

		If Select(cAliasTMP) > 0
			(cAliasTMP)->(dbCloseArea())
		EndIf

		dBUseArea(.T., "TOPCONN", TCGenQry(,,cQuery), cAliasTMP, .F., .T.)

		If (cAliasTMP)->TOTAL == 0
			U_LTALL001("Aten็ใo", "Nใo existe Mov. Transportador para เ data, linha, transportador e placa informada.","Favor providenciar เ inclusใo de Mov. Transportador referente เ Placa desta Pesagem.")
			lRet := .F.
		EndIf
	EndIf


Return lRet


User Function XSTPROT()
	Local _lRet := .F.

	DbSelectArea('ZM4')
	ZM4->(DbSetOrder(1))
	ZM4->(dbGoTop())
	ZM4->(dbSeek(xFilial("ZM4")+ZM1->ZM1_NUM))
	While !ZM4->(eof()) .AND. ZM4->ZM4_FILIAL+ZM4->ZM4_NUM == xFilial("ZM4")+ZM1->ZM1_NUM
		If ZM4->ZM4_STATUS == 'P'
			_lRet := .T.
			exit
		EndIf
		ZM4->(dbSkip())
	EndDo

Return _lRet


User Function LTPRCSOL()

	Local nPrcSol		:= 0
	Local cQuery		:= ""
	Local cAliasTMP		:= GetNextAlias()
	Local hEnter		:= CHR(10)

	//ฺฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	//ณComposi็ใo da consulta SQL de anแlise dos registros
	//ภฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤฤ
	cQuery := "SELECT ZME.ZME_PRECO				                        " + hEnter
	cQuery += "FROM " + RetSQLName("ZME") + " ZME				        " + hEnter
	cQuery += "WHERE ZME.ZME_FILIAL  = '" + xFilial("ZME")        + "'	" + hEnter
	cQuery += "  AND ZME.ZME_PROD       = '" + M->ZM1_PROD        + "'  " + hEnter
	cQuery += "  AND ZME.ZME_FORNEC     = '" + M->ZM1_CLIFOR      + "'	" + hEnter
	cQuery += "  AND ZME.ZME_LOJA       = '" + M->ZM1_LOJA        + "'	" + hEnter
	cQuery += "  AND ZME.ZME_DTDE     <= '" + dtos(M->ZM1_DATA)     + "'	" + hEnter
	cQuery += "  AND ZME.ZME_DTATE    >= '" + dtos(M->ZM1_DATA)     + "'	" + hEnter
	cQuery += "  AND ZME.D_E_L_E_T_ <> '*'						" + hEnter

	TCQUERY ChangeQuery( cQuery ) NEW ALIAS (cAliasTMP)

	dbSelectArea(cAliasTMP)
	(cAliasTMP)->(dbGoTop())

	While ! (cAliasTMP)->(EOF())

		If !EMPTY((cAliasTMP)->ZME_PRECO)
			nPrcSol := (cAliasTMP)->ZME_PRECO
		Endif
		(cAliasTMP)->(dbSkip())
	EndDo
	(cAliasTMP)->(dbCloseArea())

RETURN nPrcSol


User Function LTVERNT()
	Local cAliasTMP 	:= GetNextAlias()
	Local hEnter    	:= CHR(13) + CHR(10)
	Local cQuery 		:= ""
	Local lRet 			:= .T.
	
	cQuery := "SELECT ZM1_NFCOM NOTA" 			+ hEnter
	cQuery += "FROM " + RetSQLName("ZM1") + " ZM1 	"	+ hEnter
	cQuery += "WHERE ZM1_NFCOM ='" +  M->ZM1_NFCOM  + "'" 	+ hEnter
	cQuery += "AND ZM1_SRCOM ='" +  M->ZM1_SRCOM  + "'" 	+ hEnter
	cQuery += "AND ZM1_CLIFOR ='" +  M->ZM1_CLIFOR  + "'" 	+ hEnter
	cQuery += "AND ZM1_LOJA ='" +  M->ZM1_LOJA  + "'" 	+ hEnter
	cQuery += "AND ZM1.D_E_L_E_T_ <> '*'" 	+ hEnter

	TCQUERY ChangeQuery( cQuery ) NEW ALIAS (cAliasTMP)
	dbSelectArea(cAliasTMP)
	(cAliasTMP)->(dbGoTop())

	If !Empty(Alltrim((cAliasTMP)->NOTA))
		U_GLALL001("Aten็ใo", "Os campos referentes เ Nota Fiscal e S้rie do fornecedor estใo inconsistentes.", "O n๚mero e s้rie informados jแ foram utilizados em outra pesagem.")
		lRet 			:= .F.
	EndIf

Return lRet
